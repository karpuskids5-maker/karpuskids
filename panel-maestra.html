<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Maestra - Karpus Kids</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/karpus-modern.css" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="js/auth.js?v=1"></script>
  <script>
    (function(){
      const check = Auth.requireRole('maestra');
      if(!check.ok){ window.location.href = 'login.html'; }
    })();
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            karpus: {
              orange: '#FF8A00', 
              pink: '#FF4081', 
              blue: '#2196F3', 
              green: '#4CAF50',
              purple: '#9C27B0',
              teal: '#009688',
              yellow: '#FFC107'
            }
          },
          fontFamily: {
            nunito: ['Nunito', 'sans-serif'],
            poppins: ['Poppins', 'sans-serif'],
          },
          borderRadius: { '3xl': '1.5rem' }
        }
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    /* Sidebar styles */
    aside#sidebar { width: 260px; transition: width .25s ease, transform .25s ease; }
    aside#sidebar.collapsed { width: 72px; }
    aside#sidebar .label { transition: opacity .2s ease; }
    aside#sidebar.collapsed .label { opacity: 0; }
    /* mobile helper */
    .hidden-mobile { display: none !important; }
    /* color variants */
    .sidebar-green { background: linear-gradient(135deg,#E8F8F0,#D0F0E0); }
    .sidebar-yellow { background: linear-gradient(135deg,#FFF8E0,#FFF1C2); }
    .sidebar-pink { background: linear-gradient(135deg,#FFF0F6,#FFE3F0); }
    /* Karpus colored letters small */
    .karpus-kids-inline { font-weight: 700; }
    .karpus-kids-inline .k-1 { color: #FF9800; }
    .karpus-kids-inline .k-2 { color: #2196F3; }
    .karpus-kids-inline .k-3 { color: #E91E63; }
    .karpus-kids-inline .k-4 { color: #4CAF50; }
    .karpus-kids-inline .k-5 { color: #FF9800; }
    .karpus-kids-inline .k-6 { color: #2196F3; }
    .karpus-kids-inline .k-7 { color: #4CAF50; }
    .karpus-kids-inline .k-8 { color: #E91E63; }
    .karpus-kids-inline .k-9 { color: #2196F3; }
    .karpus-kids-inline .k-10 { color: #FF9800; }
    
    /* Estilos para modales m√°s grandes y profesionales */
    .modal-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .modal-container.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    
    .modal-container.active .modal-content {
      transform: scale(1);
    }
    
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .modal-body {
      padding: 1.5rem;
    }
    
    .modal-footer {
      padding: 1.5rem;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }
    
    /* Estilos para formularios en modales */
    .form-group {
      margin-bottom: 1.25rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #374151;
    }
    
    .form-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      background-color: #f9fafb;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .form-select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      background-color: #f9fafb;
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.75rem center;
      background-repeat: no-repeat;
      background-size: 1.25rem;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-white to-slate-50 text-slate-900 min-h-screen">
  <header class="p-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <button id="toggleSidebar" class="p-2 mr-2 rounded bg-white shadow hidden md:inline-flex" title="Ocultar/Mostrar sidebar">‚ò∞</button>
      <h1 class="text-lg font-semibold">Panel de Maestra</h1>
      <select id="classroomSelect" class="px-3 py-2 border rounded-xl text-sm">
        <option value="pequenos">Peque√±os</option>
        <option value="medianos">Medianos</option>
        <option value="grandes">Grandes</option>
      </select>
    </div>
    <div class="hidden md:block text-xs text-slate-500">Bienvenida, Ana</div>
  </header>

  <div class="min-h-screen flex font-nunito">
    <!-- Sidebar -->
    <aside id="sidebar" class="hidden md:block gradient-purple-blue p-4 rounded-r-3xl shadow-lg">
      <div class="flex items-center gap-3 mb-6">
        <div class="h-12 w-12 rounded-2xl bg-white flex items-center justify-center shadow-soft">
          <img src="img/mundo.jpg" alt="logo" class="h-10 w-10 rounded-lg object-cover" />
        </div>
        <div class="label">
          <h3 class="font-semibold text-white"><span class="karpus-kids-inline"><span class="k-1">K</span><span class="k-2">a</span><span class="k-3">r</span><span class="k-4">p</span><span class="k-5">u</span><span class="k-6">s</span> <span class="k-7">K</span><span class="k-8">i</span><span class="k-9">d</span><span class="k-10">s</span></span></h3>
          <p class="text-xs text-white text-opacity-80">Panel - Maestra</p>
        </div>
      </div>

  <div id="modalEditTask" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Editar tarea</h3>
      <input id="editTaskTitle" class="w-full border rounded-xl p-2 text-sm" placeholder="T√≠tulo" />
      <textarea id="editTaskDesc" class="w-full border rounded-xl p-2 text-sm mt-2" rows="3" placeholder="Descripci√≥n"></textarea>
      <label class="block text-xs text-slate-600 mt-2">Fecha de publicaci√≥n</label>
      <input id="editTaskPublish" type="date" class="w-full border rounded-xl p-2 text-sm" />
      <label class="block text-xs text-slate-600 mt-2">Fecha de entrega</label>
      <input id="editTaskDue" type="date" class="w-full border rounded-xl p-2 text-sm" />
      <label class="block text-xs text-slate-600 mt-2">Adjuntar archivos adicionales</label>
      <input id="editTaskFiles" type="file" multiple accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx" class="w-full border rounded-xl p-2 text-sm" />
      <div class="flex justify-end gap-2 mt-3">
        <button id="closeEditTask" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cancelar</button>
        <button id="submitEditTask" class="text-sm px-3 py-2 rounded-xl bg-karpus-blue text-white">Guardar</button>
      </div>
    </div>
  </div>

  <div id="modalAttendanceDetails" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-96">
      <h3 class="text-sm font-semibold mb-2">Detalles de Asistencia</h3>
      <div id="attendanceDetailsContent" class="space-y-2 max-h-80 overflow-auto">
        <!-- Contenido din√°mico de asistencia -->
      </div>
      <div class="flex justify-end mt-3">
        <button id="closeAttendanceDetails" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cerrar</button>
      </div>
    </div>
  </div>

      <nav class="teams-nav bg-white bg-opacity-10 rounded-xl mb-4">
        <button data-section="t-home" class="teams-nav-item active">
          <i data-lucide="home" class="text-white"></i>
          <span class="label text-white">Inicio</span>
        </button>
        <button data-section="t-classroom" class="teams-nav-item">
          <i data-lucide="globe" class="text-white"></i>
          <span class="label text-white">Aula</span>
        </button>
        <button data-section="t-tasks" class="teams-nav-item">
          <i data-lucide="book-open" class="text-white"></i>
          <span class="label text-white">Tareas</span>
          <span class="notification-badge ml-auto">3</span>
        </button>
        <button data-section="t-attendance" class="teams-nav-item">
          <i data-lucide="check-square" class="text-white"></i>
          <span class="label text-white">Asistencia</span>
        </button>
        <button data-section="t-notifications" class="teams-nav-item">
          <i data-lucide="bell" class="text-white"></i>
          <span class="label text-white">Avisos</span>
          <span class="notification-badge ml-auto">5</span>
        </button>
        <button data-section="t-chat" class="teams-nav-item">
          <i data-lucide="message-circle" class="text-white"></i>
          <span class="label text-white">Chat</span>
          <span class="notification-badge ml-auto">2</span>
        </button>
        <button data-section="t-calendar" class="teams-nav-item">
          <i data-lucide="calendar" class="text-white"></i>
          <span class="label text-white">Calendario</span>
        </button>
        <button data-section="t-profile" class="teams-nav-item">
          <i data-lucide="user" class="text-white"></i>
          <span class="label text-white">Perfil</span>
        </button>
        <a href="index.html" class="teams-nav-item">
          <i data-lucide="log-out" class="text-white"></i>
          <span class="label text-white">Cerrar sesi√≥n</span>
        </a>
      </nav>

      <div class="mt-6">
        <p class="text-xs text-slate-600 mb-2">Color sidebar</p>
        <div class="flex gap-2">
          <button class="w-8 h-8 rounded-full bg-green-500" data-color="green" title="Verde"></button>
          <button class="w-8 h-8 rounded-full bg-yellow-400" data-color="yellow" title="Amarillo"></button>
          <button class="w-8 h-8 rounded-full bg-pink-400" data-color="pink" title="Rosa"></button>
        </div>
      </div>
    </aside>

    <main class="flex-1 pb-24 px-4">
    <!-- Dashboard -->
    <section id="t-home" class="space-y-4">
      <h2 class="text-xl font-semibold flex items-center gap-2">
        <i data-lucide="layout-dashboard" class="w-5 h-5 text-karpus-blue"></i><span>Resumen</span>
      </h2>
      <div class="grid grid-cols-3 gap-2" id="dashboardSummary"></div>
      <div class="rounded-3xl bg-white p-4 border">
        <canvas id="attendanceChartTeacher" height="160"></canvas>
      </div>
      <h3 class="text-base font-semibold pt-4">√öltimas Publicaciones</h3>
      <div class="space-y-3" id="latestPosts"></div>
    </section>

    <!-- Classroom -->
    <section id="t-classroom" class="space-y-3 hidden">
      <h2 class="text-xl font-semibold flex items-center gap-2">
        <i data-lucide="presentation" class="w-5 h-5 text-karpus-orange"></i><span>Gesti√≥n del Aula</span>
      </h2>
      <div class="flex items-center gap-3">
        <input type="date" id="classDateFilter" class="px-3 py-2 border rounded-xl text-sm" />
        <button id="openAddPost" class="text-sm px-3 py-2 rounded-xl bg-karpus-orange text-white">A√±adir publicaci√≥n</button>
        <button id="openHistory" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Historial</button>
      </div>
      <h3 class="text-base font-semibold pt-4">Publicaciones Recientes</h3>
      <div id="classroomFeed" class="space-y-3"></div>
    </section>

    <!-- Tasks -->
    <section id="t-tasks" class="space-y-3 hidden">
      <h2 class="text-xl font-semibold flex items-center gap-2">
        <i data-lucide="book-check" class="w-5 h-5 text-karpus-blue"></i><span>Gesti√≥n de Tareas</span>
      </h2>
      <div class="flex items-center gap-3">
        <input type="date" id="taskDateFilter" class="px-3 py-2 border rounded-xl text-sm" />
        <button id="openCreateTask" class="text-sm px-3 py-2 rounded-xl bg-karpus-blue text-white">Crear tarea</button>
      </div>
      <h3 class="text-base font-semibold pt-4">Tareas Asignadas</h3>
      <div id="taskList" class="space-y-3"></div>
    </section>

    <!-- Notifications / Chat privado -->
    <section id="t-notifications" class="space-y-3 hidden">
      <h2 class="text-xl font-semibold flex items-center gap-2 font-poppins">
        <i data-lucide="message-square" class="w-5 h-5 text-karpus-pink"></i><span>Comunicaciones</span>
      </h2>
      <div class="grid md:grid-cols-3 gap-3">
        <div class="md:col-span-1 rounded-3xl bg-white p-3 border shadow-soft">
          <input id="contactFilter" class="w-full border rounded-xl px-2 py-1 text-sm" placeholder="Filtrar contacto" />
          <div id="contactList" class="mt-2 space-y-1 max-h-64 overflow-auto"></div>
        </div>
        <div class="md:col-span-2 rounded-3xl bg-white p-3 border shadow-soft flex flex-col">
          <div id="chatHeader" class="text-sm font-semibold">Chat</div>
          <div id="chatMessages" class="flex-1 mt-2 space-y-2 max-h-64 overflow-auto"></div>
          <div id="typingIndicator" class="text-[11px] text-slate-500"></div>
          <div class="mt-2 flex gap-2 items-center">
            <button id="chatEmoji" class="px-2 py-1 rounded bg-slate-100 hover:bg-slate-200 transition-colors">üòÄ</button>
            <input id="chatInput" class="flex-1 border rounded-xl px-2 py-1 text-sm" placeholder="Escribe un mensaje" />
            <button id="chatSend" class="text-sm px-3 py-2 rounded-xl bg-karpus-pink text-white hover:bg-pink-500 transition-colors">Enviar</button>
          </div>
          <div id="emojiMenu" class="hidden border rounded p-2"></div>
        </div>
      </div>
    </section>

    <!-- Profile -->
    <section id="t-profile" class="space-y-3 hidden">
      <h2 class="text-xl font-semibold flex items-center gap-2">
        <i data-lucide="user-cog" class="w-5 h-5 text-karpus-blue"></i><span>Perfil y Herramientas</span>
      </h2>
      <div class="rounded-3xl bg-white p-4 border mt-2">
        <h3 class="text-sm font-semibold mb-2">Perfil de la Maestra</h3>
        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-xs">Nombre</label>
            <input id="pfName" class="w-full border rounded-xl px-2 py-1 text-sm" />
            <label class="block text-xs mt-2">Email</label>
            <input id="pfEmail" class="w-full border rounded-xl px-2 py-1 text-sm" />
            <label class="block text-xs mt-2">Tel√©fono</label>
            <input id="pfPhone" class="w-full border rounded-xl px-2 py-1 text-sm" />
          </div>
          <div>
            <label class="block text-xs">Biograf√≠a</label>
            <textarea id="pfBio" rows="4" class="w-full border rounded-xl px-2 py-1 text-sm"></textarea>
            <label class="block text-xs mt-2">Avatar</label>
            <input id="pfAvatar" type="file" accept="image/*" class="w-full border rounded-xl px-2 py-1 text-sm" />
          </div>
        </div>
        <div class="flex items-center gap-3 mt-3">
          <button id="saveProfile" class="text-sm px-3 py-2 rounded-xl bg-karpus-green text-white">Guardar</button>
          <button id="openViewParents" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Ver padres</button>
          <button id="openCalendar" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Calendario</button>
          <button id="openMessage" class="text-sm px-3 py-2 rounded-xl bg-karpus-pink text-white">Mensaje</button>
          <button id="openExport" class="text-sm px-3 py-2 rounded-xl bg-karpus-orange text-white">Exportar</button>
          <a href="panel_padres.html" class="text-sm px-3 py-2 rounded-xl border">Ver panel Padres</a>
          <a href="panel_directora.html" class="text-sm px-3 py-2 rounded-xl border">Ver panel Directora</a>
        </div>
      </div>
    </section>
  </main>
  </div>

  <!-- Bottom nav -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t md:hidden">
    <div class="grid grid-cols-7">
      <button class="t-btn px-3 py-3 text-xs" data-tab="home">Inicio</button>
      <button class="t-btn px-3 py-3 text-xs" data-tab="classroom">Aula</button>
      <button class="t-btn px-3 py-3 text-xs" data-tab="tasks">Tareas</button>
      <button class="t-btn px-3 py-3 text-xs" data-tab="attendance">Asistencia</button>
      <button class="t-btn px-3 py-3 text-xs" data-tab="notifications">Avisos</button>
      <button class="t-btn px-3 py-3 text-xs" data-tab="profile">Perfil</button>
      <a class="px-3 py-3 text-xs text-center" href="index.html">Salir</a>
    </div>
  </nav>

  <!-- Modals -->
  <div id="modalAddPost" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Nueva publicaci√≥n</h3>
      <textarea id="postText" class="w-full border rounded-xl p-2 text-sm" rows="3" placeholder="Texto"></textarea>
      <label class="block text-xs text-slate-600 mt-2">Foto (opcional)</label>
      <input id="postPhoto" type="file" accept="image/*" class="w-full border rounded-xl p-2 text-sm" />
      <label class="block text-xs text-slate-600 mt-2">Video (opcional)</label>
      <input id="postVideo" type="file" accept="video/*" class="w-full border rounded-xl p-2 text-sm" />
      <label class="block text-xs text-slate-600 mt-2">Documento (opcional)</label>
      <input id="postDoc" type="file" accept=".pdf,.doc,.docx,.xls,.xlsx" class="w-full border rounded-xl p-2 text-sm" />
      <div class="flex justify-end gap-2 mt-3">
        <button id="closeAddPost" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cancelar</button>
        <button id="submitPost" class="text-sm px-3 py-2 rounded-xl bg-karpus-orange text-white">Guardar</button>
      </div>
    </div>
  </div>

  <div id="modalHistory" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-96">
      <h3 class="text-sm font-semibold mb-2">Historial de publicaciones</h3>
      <div id="historyList" class="space-y-2 max-h-64 overflow-auto"></div>
      <div class="flex justify-end mt-3"><button id="closeHistory" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cerrar</button></div>
    </div>
  </div>

  <div id="modalCreateTask" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Crear tarea</h3>
      <input id="taskTitle" class="w-full border rounded-xl p-2 text-sm" placeholder="T√≠tulo" />
      <textarea id="taskDesc" class="w-full border rounded-xl p-2 text-sm mt-2" rows="3" placeholder="Descripci√≥n"></textarea>
      <label class="block text-xs text-slate-600 mt-2">Fecha de publicaci√≥n</label>
      <input id="taskPublish" type="date" class="w-full border rounded-xl p-2 text-sm" />
      <label class="block text-xs text-slate-600 mt-2">Fecha de entrega</label>
      <input id="taskDue" type="date" class="w-full border rounded-xl p-2 text-sm" />
      <label class="block text-xs text-slate-600 mt-2">Adjuntos (foto/video/documento)</label>
      <input id="taskFiles" type="file" multiple accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx" class="w-full border rounded-xl p-2 text-sm" />
      <div class="flex justify-end gap-2 mt-3">
        <button id="closeCreateTask" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cancelar</button>
        <button id="submitTask" class="text-sm px-3 py-2 rounded-xl bg-karpus-blue text-white">Guardar</button>
      </div>
    </div>
  </div>

  <div id="modalGradeTask" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Calificar Tarea: <span id="gradeTaskTitle" class="font-normal"></span></h3>
      <div id="gradeList" class="space-y-3 max-h-72 overflow-auto">
        <!-- Las entregas de los estudiantes se renderizar√°n aqu√≠ -->
        <p class="text-center text-sm text-slate-500 p-4">No hay entregas para calificar.</p>
      </div>
      <div class="flex justify-end gap-2 mt-3">
        <button id="closeGradeTask" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cerrar</button>
        <button id="saveGrades" class="text-sm px-3 py-2 rounded-xl bg-karpus-orange text-white">Guardar Calificaciones</button>
      </div>
    </div>
  </div>

  <div id="modalViewSubmissions" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Entregas de padres</h3>
      <div id="submissionsList" class="space-y-2 max-h-64 overflow-auto"></div>
      <div class="flex justify-end mt-3"><button id="closeViewSubmissions" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cerrar</button></div>
    </div>
  </div>

  <div id="modalSendNotification" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Enviar notificaci√≥n</h3>
      <textarea id="notifText" class="w-full border rounded-xl p-2 text-sm" rows="3" placeholder="Mensaje"></textarea>
      <div class="flex justify-end gap-2 mt-3">
        <button id="closeSendNotification" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cancelar</button>
        <button id="submitNotification" class="text-sm px-3 py-2 rounded-xl bg-karpus-pink text-white">Enviar</button>
      </div>
    </div>
  </div>

  <div id="modalViewParents" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-96">
      <h3 class="text-sm font-semibold mb-2">Padres</h3>
      <div id="parentsList" class="space-y-2 max-h-64 overflow-auto"></div>
      <div class="flex justify-end mt-3"><button id="closeViewParents" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cerrar</button></div>
    </div>
  </div>

  <div id="modalCalendar" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Calendario</h3>
      <p class="text-sm text-slate-600">(Placeholder de calendario)</p>
      <div class="flex justify-end mt-3"><button id="closeCalendar" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cerrar</button></div>
    </div>
  </div>

  <div id="modalMessage" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Mensaje privado</h3>
      <select id="messageTo" class="w-full border rounded-xl p-2 text-sm bg-white"></select>
      <textarea id="messageText" class="w-full border rounded-xl p-2 text-sm mt-2" rows="3" placeholder="Mensaje"></textarea>
      <div class="flex justify-end gap-2 mt-3"><button id="closeMessage" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cancelar</button><button id="sendMessage" class="text-sm px-3 py-2 rounded-xl bg-karpus-pink text-white">Enviar</button></div>
    </div>
  </div>

  <div id="modalExport" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-3xl p-4 w-80">
      <h3 class="text-sm font-semibold mb-2">Exportar</h3>
      <p class="text-sm text-slate-600">Generar reporte de aula (placeholder).</p>
      <div class="flex justify-end gap-2 mt-3"><button id="closeExport" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cerrar</button><button id="doExport" class="text-sm px-3 py-2 rounded-xl bg-karpus-orange text-white">Exportar</button></div>
    </div>
  </div>

  <script src="js/store.js?v=2"></script>
  <script src="js/maestra_patch.js?v=2"></script>
  <script src="js/asistencia_maestra.js?v=1"></script>
</body>
</html>

// Sistema de asistencia
document.addEventListener('DOMContentLoaded', function() {
  // Datos de ejemplo para estudiantes
  const estudiantes = [
    { id: 1, nombre: 'Ana Garc√≠a', estado: 'Ausente', hora: '', notificado: false, padre: 'Juan Garc√≠a', telefono: '555-1234' },
    { id: 2, nombre: 'Carlos P√©rez', estado: 'Ausente', hora: '', notificado: false, padre: 'Mar√≠a P√©rez', telefono: '555-5678' },
    { id: 3, nombre: 'Sof√≠a Rodr√≠guez', estado: 'Ausente', hora: '', notificado: false, padre: 'Roberto Rodr√≠guez', telefono: '555-9012' },
    { id: 4, nombre: 'Diego Mart√≠nez', estado: 'Ausente', hora: '', notificado: false, padre: 'Laura Mart√≠nez', telefono: '555-3456' },
    { id: 5, nombre: 'Valentina L√≥pez', estado: 'Ausente', hora: '', notificado: false, padre: 'Pedro L√≥pez', telefono: '555-7890' },
    { id: 6, nombre: 'Mateo S√°nchez', estado: 'Ausente', hora: '', notificado: false, padre: 'Ana S√°nchez', telefono: '555-2345' },
    { id: 7, nombre: 'Isabella G√≥mez', estado: 'Ausente', hora: '', notificado: false, padre: 'Carlos G√≥mez', telefono: '555-6789' },
    { id: 8, nombre: 'Santiago Torres', estado: 'Ausente', hora: '', notificado: false, padre: 'Elena Torres', telefono: '555-0123' }
  ];
  
  // Elementos DOM
  const seccionAsistencia = document.getElementById('asistencia');
  const seccionDashboard = document.getElementById('dashboard');
  const listaAsistencia = document.getElementById('listaAsistencia');
  const fechaAsistencia = document.getElementById('fechaAsistencia');
  const contPresentes = document.getElementById('contPresentes');
  const contAusentes = document.getElementById('contAusentes');
  const contRetardos = document.getElementById('contRetardos');
  const buscarEstudiante = document.getElementById('buscarEstudiante');
  const exportarAsistencia = document.getElementById('exportarAsistencia');
  const notificarTodos = document.getElementById('notificarTodos');
  const modalAsistenciaDetalles = document.getElementById('modalAsistenciaDetalles');
  const detallesAsistenciaContent = document.getElementById('detallesAsistenciaContent');
  const cerrarDetallesAsistencia = document.getElementById('cerrarDetallesAsistencia');
  const modalNotificarPadre = document.getElementById('modalNotificarPadre');
  const nombreEstudianteNotificacion = document.getElementById('nombreEstudianteNotificacion');
  const estadoEstudianteNotificacion = document.getElementById('estadoEstudianteNotificacion');
  const mensajeAdicional = document.getElementById('mensajeAdicional');
  const cerrarNotificarPadre = document.getElementById('cerrarNotificarPadre');
  const enviarNotificacion = document.getElementById('enviarNotificacion');
  
  // Mostrar fecha actual
  const hoy = new Date();
  fechaAsistencia.textContent = hoy.toLocaleDateString('es-ES', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  
  // Funci√≥n para actualizar contadores
  function actualizarContadores() {
    const presentes = estudiantes.filter(e => e.estado === 'Presente').length;
    const ausentes = estudiantes.filter(e => e.estado === 'Ausente').length;
    const retardos = estudiantes.filter(e => e.estado === 'Retardo').length;
    
    contPresentes.textContent = presentes;
    contAusentes.textContent = ausentes;
    contRetardos.textContent = retardos;
  }
  
  // Funci√≥n para renderizar la lista de asistencia
  function renderizarAsistencia(filtro = '') {
    listaAsistencia.innerHTML = '';
    
    const estudiantesFiltrados = estudiantes.filter(e => 
      e.nombre.toLowerCase().includes(filtro.toLowerCase())
    );
    
    estudiantesFiltrados.forEach(estudiante => {
      const fila = document.createElement('tr');
      fila.className = 'border-b hover:bg-slate-50';
      
      // Clase para el estado
      let estadoClase = '';
      let estadoIcono = '';
      
      switch(estudiante.estado) {
        case 'Presente':
          estadoClase = 'bg-green-100 text-green-800';
          estadoIcono = 'check';
          break;
        case 'Ausente':
          estadoClase = 'bg-red-100 text-red-800';
          estadoIcono = 'x';
          break;
        case 'Retardo':
          estadoClase = 'bg-yellow-100 text-yellow-800';
          estadoIcono = 'clock';
          break;
      }
      
      fila.innerHTML = `
        <td class="py-2 px-3">${estudiante.nombre}</td>
        <td class="py-2 px-3 text-center">
          <span class="inline-flex items-center gap-1 px-2 py-1 rounded-xl ${estadoClase}">
            <i data-lucide="${estadoIcono}" class="w-3 h-3"></i> ${estudiante.estado}
          </span>
        </td>
        <td class="py-2 px-3 text-center">${estudiante.hora || '-'}</td>
        <td class="py-2 px-3 text-center">
          ${estudiante.notificado 
            ? '<span class="text-green-600"><i data-lucide="check" class="w-4 h-4"></i></span>' 
            : '<span class="text-slate-400">No</span>'}
        </td>
        <td class="py-2 px-3 text-right">
          <div class="flex justify-end gap-1">
            <button class="btn-presente p-1 rounded-full hover:bg-green-100" title="Marcar presente" data-id="${estudiante.id}">
              <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
            </button>
            <button class="btn-ausente p-1 rounded-full hover:bg-red-100" title="Marcar ausente" data-id="${estudiante.id}">
              <i data-lucide="x" class="w-4 h-4 text-red-600"></i>
            </button>
            <button class="btn-retardo p-1 rounded-full hover:bg-yellow-100" title="Marcar retardo" data-id="${estudiante.id}">
              <i data-lucide="clock" class="w-4 h-4 text-yellow-600"></i>
            </button>
            <button class="btn-notificar p-1 rounded-full hover:bg-blue-100" title="Notificar a padre/madre" data-id="${estudiante.id}">
              <i data-lucide="bell" class="w-4 h-4 text-blue-600"></i>
            </button>
            <button class="btn-detalles p-1 rounded-full hover:bg-slate-100" title="Ver detalles" data-id="${estudiante.id}">
              <i data-lucide="info" class="w-4 h-4 text-slate-600"></i>
            </button>
          </div>
        </td>
      `;
      
      listaAsistencia.appendChild(fila);
    });
    
    // Recrear √≠conos
    lucide.createIcons();
    
    // A√±adir event listeners a los botones
    document.querySelectorAll('.btn-presente').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = parseInt(this.getAttribute('data-id'));
        marcarAsistencia(id, 'Presente');
      });
    });
    
    document.querySelectorAll('.btn-ausente').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = parseInt(this.getAttribute('data-id'));
        marcarAsistencia(id, 'Ausente');
      });
    });
    
    document.querySelectorAll('.btn-retardo').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = parseInt(this.getAttribute('data-id'));
        marcarAsistencia(id, 'Retardo');
      });
    });
    
    document.querySelectorAll('.btn-notificar').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = parseInt(this.getAttribute('data-id'));
        abrirModalNotificar(id);
      });
    });
    
    document.querySelectorAll('.btn-detalles').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = parseInt(this.getAttribute('data-id'));
        mostrarDetallesAsistencia(id);
      });
    });
  }
  
  // Funci√≥n para marcar asistencia
  function marcarAsistencia(id, estado) {
    const estudiante = estudiantes.find(e => e.id === id);
    if (estudiante) {
      const horaActual = new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
      estudiante.estado = estado;
      estudiante.hora = horaActual;
      
      // Si el estado es "Presente", notificar autom√°ticamente
      if (estado === 'Presente') {
        notificarPadre(id, `Su hijo/a ${estudiante.nombre} ha llegado a la escuela y est√° presente en el aula.`);
      }
      
      renderizarAsistencia(buscarEstudiante.value);
      actualizarContadores();
    }
  }
  
  // Funci√≥n para mostrar detalles de asistencia
  function mostrarDetallesAsistencia(id) {
    const estudiante = estudiantes.find(e => e.id === id);
    if (estudiante) {
      detallesAsistenciaContent.innerHTML = `
        <div class="p-3 bg-slate-50 rounded-xl">
          <h4 class="font-medium">${estudiante.nombre}</h4>
          <div class="grid grid-cols-2 gap-2 mt-2 text-xs">
            <div>
              <p class="text-slate-500">Estado:</p>
              <p class="font-medium">${estudiante.estado}</p>
            </div>
            <div>
              <p class="text-slate-500">Hora:</p>
              <p class="font-medium">${estudiante.hora || 'No registrada'}</p>
            </div>
            <div>
              <p class="text-slate-500">Padre/Madre:</p>
              <p class="font-medium">${estudiante.padre}</p>
            </div>
            <div>
              <p class="text-slate-500">Tel√©fono:</p>
              <p class="font-medium">${estudiante.telefono}</p>
            </div>
            <div class="col-span-2">
              <p class="text-slate-500">Notificaci√≥n:</p>
              <p class="font-medium">${estudiante.notificado ? 'Enviada' : 'No enviada'}</p>
            </div>
          </div>
        </div>
      `;
      
      modalAsistenciaDetalles.classList.remove('hidden');
    }
  }
  
  // Funci√≥n para abrir modal de notificaci√≥n
  function abrirModalNotificar(id) {
    const estudiante = estudiantes.find(e => e.id === id);
    if (estudiante) {
      nombreEstudianteNotificacion.textContent = estudiante.nombre;
      estadoEstudianteNotificacion.textContent = estudiante.estado;
      mensajeAdicional.value = '';
      
      // Guardar ID del estudiante en el bot√≥n de enviar
      enviarNotificacion.setAttribute('data-id', id);
      
      modalNotificarPadre.classList.remove('hidden');
    }
  }
  
  // Funci√≥n para notificar a padre/madre
  function notificarPadre(id, mensaje = '') {
    const estudiante = estudiantes.find(e => e.id === id);
    if (estudiante) {
      estudiante.notificado = true;
      
      // Aqu√≠ ir√≠a la l√≥gica para enviar la notificaci√≥n real
      console.log(`Notificaci√≥n enviada a ${estudiante.padre} (${estudiante.telefono}): ${mensaje}`);
      
      // Actualizar la interfaz
      renderizarAsistencia(buscarEstudiante.value);
    }
  }
  
  // Funci√≥n para exportar asistencia
  function exportarReporteAsistencia() {
    const fecha = new Date().toLocaleDateString('es-ES');
    let csv = `Reporte de Asistencia - ${fecha}\n\n`;
    csv += 'Nombre,Estado,Hora,Notificado\n';
    
    estudiantes.forEach(e => {
      csv += `${e.nombre},${e.estado},${e.hora || '-'},${e.notificado ? 'S√≠' : 'No'}\n`;
    });
    
    // Crear blob y descargar
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', `asistencia_${fecha.replace(/\//g, '-')}.csv`);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
  
  // Funci√≥n para notificar a todos los padres
  function notificarTodosLosPadres() {
    const presentes = estudiantes.filter(e => e.estado === 'Presente' && !e.notificado);
    
    presentes.forEach(estudiante => {
      notificarPadre(estudiante.id, `Su hijo/a ${estudiante.nombre} est√° presente en el aula.`);
    });
    
    alert(`Se han enviado ${presentes.length} notificaciones a padres de alumnos presentes.`);
  }
  
  // Event Listeners
  buscarEstudiante.addEventListener('input', function() {
    renderizarAsistencia(this.value);
  });
  
  exportarAsistencia.addEventListener('click', exportarReporteAsistencia);
  
  notificarTodos.addEventListener('click', notificarTodosLosPadres);
  
  cerrarDetallesAsistencia.addEventListener('click', function() {
    modalAsistenciaDetalles.classList.add('hidden');
  });
  
  cerrarNotificarPadre.addEventListener('click', function() {
    modalNotificarPadre.classList.add('hidden');
  });
  
  enviarNotificacion.addEventListener('click', function() {
    const id = parseInt(this.getAttribute('data-id'));
    const mensaje = mensajeAdicional.value.trim();
    const estudiante = estudiantes.find(e => e.id === id);
    
    if (estudiante) {
      let mensajeCompleto = `Su hijo/a ${estudiante.nombre} est√° ${estudiante.estado.toLowerCase()} en el aula.`;
      
      if (mensaje) {
        mensajeCompleto += ` Mensaje adicional: ${mensaje}`;
      }
      
      notificarPadre(id, mensajeCompleto);
      modalNotificarPadre.classList.add('hidden');
    }
  });
  
  // Navegaci√≥n entre secciones
  document.querySelectorAll('nav a').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.getAttribute('href').substring(1);
      
      // Ocultar todas las secciones
      document.querySelectorAll('main > div').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Mostrar la secci√≥n seleccionada
      const targetSection = document.getElementById(targetId);
      if (targetSection) {
        targetSection.classList.remove('hidden');
      }
      
      // Actualizar clase activa en la navegaci√≥n
      document.querySelectorAll('nav a').forEach(navLink => {
        navLink.classList.remove('bg-white', 'bg-opacity-60');
        navLink.classList.add('hover:bg-white', 'hover:bg-opacity-60');
      });
      
      this.classList.add('bg-white', 'bg-opacity-60');
      this.classList.remove('hover:bg-white', 'hover:bg-opacity-60');
    });
  });
  
  // Inicializar
  renderizarAsistencia();
  actualizarContadores();
});

<!-- Modal para detalles de asistencia -->
<div id="modalAsistenciaDetalles" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
  <div class="bg-white rounded-3xl p-4 w-96 max-w-full">
    <h3 class="text-sm font-semibold mb-2">Detalles de Asistencia</h3>
    <div id="detallesAsistenciaContent" class="space-y-2 max-h-80 overflow-auto">
      <!-- Contenido din√°mico -->
    </div>
    <div class="flex justify-end gap-2 mt-3">
      <button id="cerrarDetallesAsistencia" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cerrar</button>
    </div>
  </div>
</div>

<!-- Modal para notificar a padres -->
<div id="modalNotificarPadre" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
  <div class="bg-white rounded-3xl p-4 w-96 max-w-full">
    <h3 class="text-sm font-semibold mb-2">Notificar a Padre/Madre</h3>
    <div class="mb-3">
      <p class="text-sm mb-2">Enviando notificaci√≥n a padre/madre de: <span id="nombreEstudianteNotificacion" class="font-medium"></span></p>
      <p class="text-sm mb-2">Estado: <span id="estadoEstudianteNotificacion" class="font-medium"></span></p>
    </div>
    <div class="mb-3">
      <label class="block text-xs text-slate-600 mb-1">Mensaje adicional (opcional)</label>
      <textarea id="mensajeAdicional" class="w-full border rounded-xl p-2 text-sm" rows="3" placeholder="Escriba un mensaje adicional..."></textarea>
    </div>
    <div class="flex justify-end gap-2 mt-3">
      <button id="cerrarNotificarPadre" class="text-sm px-3 py-2 rounded-xl bg-slate-100">Cancelar</button>
      <button id="enviarNotificacion" class="text-sm px-3 py-2 rounded-xl bg-karpus-blue text-white">Enviar Notificaci√≥n</button>
    </div>
  </div>
</div>
</script>