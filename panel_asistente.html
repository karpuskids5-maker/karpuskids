<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karpus Kids ‚Äî Panel Asistente</title>
  <link rel="icon" href="./logo/favicon.ico" type="image/x-icon">
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#0f766e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
  <script>
    (function(){
      if(!(window.lucide && typeof lucide.createIcons==='function')){
        var s=document.createElement('script');
        s.src='https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js';
        s.async=true;document.head.appendChild(s);
      }
    })();
  </script>
  
  <style>
    /* Estilos Karpus Kids Solicitados */
    .karpus-kids-inline { font-weight: 700; }
    .karpus-kids-inline .k-1 { color: #FF9800; }
    .karpus-kids-inline .k-2 { color: #2196F3; }
    .karpus-kids-inline .k-3 { color: #E91E63; }
    .karpus-kids-inline .k-4 { color: #4CAF50; }
    .karpus-kids-inline .k-5 { color: #FF9800; }
    .karpus-kids-inline .k-6 { color: #2196F3; }
    .karpus-kids-inline .k-7 { color: #4CAF50; }
    .karpus-kids-inline .k-8 { color: #E91E63; }
    .karpus-kids-inline .k-9 { color: #2196F3; }
    .karpus-kids-inline .k-10 { color: #FF9800; }

    /* --- SIDEBAR CORE --- */
    aside#sidebar { 
      position: fixed;
      top: 0; bottom: 0; left: 0;
      z-index: 50;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* --- DESKTOP (‚â• 768px) --- */
    @media (min-width: 768px) {
      aside#sidebar { width: 280px; transform: translateX(0); }
      
      /* Estado Colapsado */
      aside#sidebar.collapsed { width: 90px; }
      
      /* Hover Expand: Expande sidebar Y empuja contenido */
      aside#sidebar.collapsed:hover { width: 280px; box-shadow: 10px 0 30px rgba(0,0,0,0.15); }
      
      /* Layout Principal */
      #layoutShell { 
        margin-left: 280px; 
        transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        width: auto;
      }
      
      #layoutShell.sidebar-collapsed { margin-left: 90px; }
      
      /* EL TRUCO: Mover contenido al hacer hover en sidebar colapsado */
      /* Usamos el selector de hermano adyacente general (~) asumiendo que sidebar y main son hermanos */
      aside#sidebar.collapsed:hover ~ #layoutShell { margin-left: 280px !important; }

      /* Elementos internos: Texto */
      aside#sidebar .label, aside#sidebar .karpus-kids-inline, aside#sidebar #sidebarUserName {
        opacity: 1; transition: opacity 0.2s ease 0.1s; display: block; white-space: nowrap;
      }
      
      aside#sidebar.collapsed .label, 
      aside#sidebar.collapsed .karpus-kids-inline, 
      aside#sidebar.collapsed #sidebarUserName {
        opacity: 0; pointer-events: none; display: none; transition: none;
      }

      aside#sidebar.collapsed:hover .label,
      aside#sidebar.collapsed:hover .karpus-kids-inline,
      aside#sidebar.collapsed:hover #sidebarUserName {
        display: block; opacity: 1; transition: opacity 0.2s ease 0.1s;
      }

      /* Iconos y Botones */
      aside#sidebar .nav-btn { padding-left: 1rem; justify-content: flex-start; }
      aside#sidebar.collapsed .nav-btn { padding-left: 0; justify-content: center; }
      aside#sidebar.collapsed:hover .nav-btn { padding-left: 1rem; justify-content: flex-start; }
      
      aside#sidebar .nav-btn i { width: 20px; height: 20px; transition: all 0.3s; }
      aside#sidebar.collapsed .nav-btn i { width: 28px; height: 28px; }
      aside#sidebar.collapsed:hover .nav-btn i { width: 20px; height: 20px; }

      /* Avatar */
      #sidebarAvatarContainer { transition: all 0.3s; width: 4rem; height: 4rem; }
      aside#sidebar.collapsed #sidebarAvatarContainer { width: 3rem; height: 3rem; border-width: 2px; }
      aside#sidebar.collapsed:hover #sidebarAvatarContainer { width: 4rem; height: 4rem; border-width: 4px; }

      /* Bot√≥n Colapsar */
      #toggleSidebar i { transition: transform 0.3s; }
      aside#sidebar.collapsed #toggleSidebar i { transform: rotate(180deg); }
    }
    
    /* --- MOBILE (< 768px) --- */
    @media (max-width: 767px) {
      aside#sidebar { width: 280px; transform: translateX(-100%); }
      aside#sidebar.mobile-visible { transform: translateX(0); box-shadow: 5px 0 25px rgba(0,0,0,0.3); }
      
      #layoutShell { margin-left: 0 !important; width: 100%; }
      #toggleSidebar { display: none !important; } /* Ocultar bot√≥n colapsar en m√≥vil */
    }

    /* Tema Asistente (Teal/Turquesa) */
    .sidebar-teal { background: linear-gradient(135deg, #0f766e, #115e59); }
    
    /* View Transitions */
    .section {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .section.active {
      display: block;
      opacity: 1;
      animation: fadeIn 0.4s ease-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      #layoutShell { margin-left: 0 !important; }
    }
    #attendanceModal { -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px); }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans panel-asistente-body">
  <div class="min-h-screen flex">
    <!-- SIDEBAR -->
    <aside id="sidebar" class="bg-gradient-to-b from-teal-500 to-emerald-600 border-r-4 border-teal-300 p-4 rounded-r-3xl shadow-2xl">
      <button id="toggleSidebar" class="absolute -right-3 top-6 bg-white rounded-full p-1 shadow-md border border-slate-100 text-slate-500 hover:text-teal-600 hidden md:block">
        <i data-lucide="chevron-left" class="w-4 h-4"></i>
      </button>
      
      <!-- Header Sidebar: Avatar + Nombre + Logo Texto -->
      <div class="flex flex-col items-center gap-4 mb-6 pt-6">
        <!-- Avatar -->
        <div class="relative group">
           <div id="sidebarAvatarContainer" class="rounded-full border-4 border-white/30 shadow-lg overflow-hidden transition-all duration-300 group-hover:scale-105">
             <img id="sidebarAvatar" src="img/1.jpg" class="w-full h-full object-cover">
           </div>
           <div class="absolute bottom-0 right-0 w-4 h-4 bg-green-400 border-2 border-white rounded-full"></div>
        </div>
        
        <!-- Texto (Se oculta al colapsar) -->
        <div class="label text-center transition-opacity duration-200">
           <h4 class="text-lg font-bold text-white mb-1" id="sidebarUserName">Asistente</h4>
           <p class="text-xs text-teal-100 font-medium uppercase tracking-wider mb-3">Panel Administrativo</p>
           
           <div class="h-px w-12 bg-white/20 mx-auto mb-3"></div>
           
           <h3 class="font-black text-white text-lg karpus-kids-inline drop-shadow-md leading-none">
            <span class="k-1">K</span><span class="k-2">a</span><span class="k-3">r</span><span class="k-4">p</span><span class="k-5">u</span><span class="k-6">s</span> <span class="k-7">K</span><span class="k-8">i</span><span class="k-9">d</span><span class="k-10">s</span>
          </h3>
        </div>
      </div>

      <nav class="space-y-2 bg-white/10 p-2 rounded-xl mb-4 backdrop-blur-sm relative z-10">
        <button data-section="dashboard" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="layout-dashboard"></i>
          <span class="label">Resumen</span>
        </button>
        <button data-section="estudiantes" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="users"></i>
          <span class="label">Estudiantes</span>
        </button>
        <button data-section="maestros" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="graduation-cap"></i>
          <span class="label">Maestros</span>
        </button>
        <button data-section="aulas" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="home"></i>
          <span class="label">Aulas</span>
        </button>
        <button data-section="accesos" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="door-open"></i>
          <span class="label">Accesos</span>
        </button>
        <button data-section="pagos" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="credit-card"></i>
          <span class="label">Pagos</span>
        </button>
        <button data-section="perfil" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="user-circle"></i>
          <span class="label">Mi Perfil</span>
        </button>
      </nav>

      <div class="mt-auto p-2 label relative z-10">
        <button id="btnLogout" class="w-full bg-white/20 hover:bg-white/30 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all shadow-sm border border-white/10">
          <i data-lucide="log-out" class="w-5 h-5"></i> 
          <span>Cerrar Sesi√≥n</span>
        </button>
      </div>

      <!-- Icono Grande Decorativo (Rompecabezas) -->
      <div class="absolute bottom-4 right-4 opacity-20 pointer-events-none transform -rotate-6">
        <i data-lucide="puzzle" class="w-32 h-32 text-white"></i>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="flex-1 p-6" id="layoutShell">
      <!-- Mobile Header -->
      <div class="md:hidden mb-6 flex items-center justify-between relative z-30">
        <button id="menuBtn" class="p-2 rounded bg-white shadow"><i data-lucide="menu"></i></button>
        <h2 class="font-semibold text-teal-700">Panel Asistente</h2>
        <div class="w-8"></div>
      </div>

      <!-- SECTIONS -->
      
      <!-- DASHBOARD -->
      <section id="dashboard" class="section active">
        <h1 class="text-2xl font-bold mb-6 text-slate-800">Hola, <span id="welcomeName">Asistente</span> üëã</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <!-- Tarjeta Estudiantes -->
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-3xl shadow-lg text-white relative overflow-hidden group transition-transform hover:-translate-y-1">
            <div class="relative z-10">
              <div class="flex items-center gap-3 mb-3">
                <div class="p-2 bg-white/20 rounded-xl backdrop-blur-sm"><i data-lucide="users" class="w-6 h-6 text-white"></i></div>
                <span class="font-bold text-blue-100 text-sm uppercase tracking-wider">Estudiantes</span>
              </div>
              <p class="text-4xl font-black tracking-tight" id="statStudents">-</p>
              <p class="text-sm text-blue-100 mt-1 font-medium">Total activos</p>
            </div>
            <i data-lucide="users" class="absolute -bottom-6 -right-6 w-32 h-32 text-white/10 transform rotate-12 group-hover:scale-110 transition-transform duration-500"></i>
          </div>

          <!-- Tarjeta Asistencia -->
          <div class="bg-gradient-to-br from-emerald-500 to-teal-600 p-6 rounded-3xl shadow-lg text-white relative overflow-hidden group transition-transform hover:-translate-y-1">
            <div class="relative z-10">
              <div class="flex items-center gap-3 mb-3">
                <div class="p-2 bg-white/20 rounded-xl backdrop-blur-sm"><i data-lucide="check-circle" class="w-6 h-6 text-white"></i></div>
                <span class="font-bold text-emerald-100 text-sm uppercase tracking-wider">Asistencia</span>
              </div>
              <p class="text-4xl font-black tracking-tight" id="statAttendance">-</p>
              <p class="text-sm text-emerald-100 mt-1 font-medium">Presentes hoy</p>
            </div>
            <i data-lucide="calendar-check" class="absolute -bottom-6 -right-6 w-32 h-32 text-white/10 transform rotate-12 group-hover:scale-110 transition-transform duration-500"></i>
          </div>

          <!-- Tarjeta Pagos -->
          <div class="bg-gradient-to-br from-orange-400 to-red-500 p-6 rounded-3xl shadow-lg text-white relative overflow-hidden group transition-transform hover:-translate-y-1">
            <div class="relative z-10">
              <div class="flex items-center gap-3 mb-3">
                <div class="p-2 bg-white/20 rounded-xl backdrop-blur-sm"><i data-lucide="alert-circle" class="w-6 h-6 text-white"></i></div>
                <span class="font-bold text-orange-100 text-sm uppercase tracking-wider">Pagos</span>
              </div>
              <p class="text-4xl font-black tracking-tight" id="statPayments">-</p>
              <p class="text-sm text-orange-100 mt-1 font-medium">Pendientes de cobro</p>
            </div>
            <i data-lucide="wallet" class="absolute -bottom-6 -right-6 w-32 h-32 text-white/10 transform rotate-12 group-hover:scale-110 transition-transform duration-500"></i>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 card-interactive">
          <h3 class="font-semibold mb-4">Accesos R√°pidos</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <button id="btnQuickStudents" class="p-4 rounded-xl bg-slate-50 hover:bg-blue-100 hover:text-blue-800 transition-colors text-center group">
              <i data-lucide="search" class="w-6 h-6 mx-auto mb-2 text-slate-500"></i>
              <span class="text-sm font-medium">Buscar Alumno</span>
            </button>
            <button id="btnQuickPayments" class="p-4 rounded-xl bg-slate-50 hover:bg-green-100 hover:text-green-800 transition-colors text-center group">
              <i data-lucide="dollar-sign" class="w-6 h-6 mx-auto mb-2 text-slate-500"></i>
              <span class="text-sm font-medium">Registrar Pago</span>
            </button>
          </div>
        </div>
      </section>

      <!-- ESTUDIANTES -->
      <section id="estudiantes" class="section">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold flex items-center gap-2 text-slate-700">
            <i data-lucide="users" class="text-slate-500"></i> Directorio de Estudiantes
          </h2>
          <div class="flex gap-2 items-center">
            <div class="relative">
              <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
              <input id="searchStudentInput" type="text" placeholder="Buscar..." class="pl-9 pr-4 py-2 border rounded-lg text-sm w-64">
            </div>
            <label class="flex items-center gap-2 text-sm text-slate-600">
              <input id="filterNoClassroom" type="checkbox" class="rounded">
              Solo sin aula
            </label>
            <button id="btnAddStudent" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium flex items-center gap-2">
              <i data-lucide="plus" class="w-4 h-4"></i>Nuevo Estudiante
            </button>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
          <table class="w-full text-sm text-left">
            <thead class="bg-slate-50 text-slate-600 font-bold uppercase text-xs tracking-wider">
              <tr>
                <th class="px-6 py-4">Nombre</th>
                <th class="px-6 py-4">Aula</th>
                <th class="px-6 py-4">Padre/Tutor</th>
                <th class="px-6 py-4">Estado</th>
              </tr>
            </thead>
            <tbody id="studentsTableBody" class="divide-y divide-slate-100">
              <!-- JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- AULAS -->
      <section id="aulas" class="section">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-bold flex items-center gap-2 text-slate-700">
            <i data-lucide="home" class="text-slate-500"></i> Gesti√≥n de Aulas
          </h2>
          <div class="flex items-center gap-3">
            <label for="filterRoomByTeacher" class="text-sm font-medium text-slate-600">Filtrar por Maestra:</label>
            <select id="filterRoomByTeacher" class="border rounded-lg px-3 py-2 text-sm">
              <option value="all">Todas las maestras</option>
            </select>
            <button id="btnAddRoom" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 flex items-center gap-2 shadow-md">
              <i data-lucide="plus" class="w-4 h-4"></i>
              Nueva Aula
            </button>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
          <table class="w-full text-sm">
            <thead class="bg-slate-50 text-left text-xs font-bold uppercase tracking-wider text-slate-600">
              <tr>
                <th class="py-3 px-4">Nombre del Aula</th>
                <th class="py-3 px-4 hidden md:table-cell">Maestra Asignada</th>
                <th class="py-3 px-4">Ocupaci√≥n</th>
                <th class="py-3 px-4 text-center">Estado</th>
                <th class="py-3 px-4 text-right">Acciones</th>
              </tr>
            </thead>
            <tbody id="roomsTable" class="divide-y divide-slate-200"></tbody>
          </table>
        </div>
      </section>

      <section id="maestros" class="section">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold flex items-center gap-2 text-slate-700">
            <i data-lucide="graduation-cap" class="text-slate-500"></i> Gesti√≥n de Maestros
          </h2>
          <div class="flex gap-2">
             <div class="relative"><i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i><input id="searchTeacherInput" placeholder="Buscar..." class="pl-9 pr-4 py-2 border rounded-lg text-sm w-64"></div>
             <button id="btnAddTeacher" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i>Nuevo Maestro</button>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
          <table class="w-full text-sm text-left">
            <thead class="bg-slate-50 text-slate-600 font-bold uppercase text-xs tracking-wider">
              <tr>
                <th class="px-6 py-4">Nombre</th>
                <th class="px-6 py-4">Correo</th>
                <th class="px-6 py-4">Tel√©fono</th>
                <th class="px-6 py-4">Acciones</th>
              </tr>
            </thead>
            <tbody id="teachersTableBody" class="divide-y divide-slate-100"></tbody>
          </table>
        </div>
      </section>

      <!-- ACCESOS (Check-in/Check-out) -->
      <section id="accesos" class="section">
        <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-slate-700">
          <i data-lucide="door-open" class="text-slate-500"></i> Control de Accesos (Check-in / Check-out)
        </h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Buscador y Acci√≥n -->
          <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border p-6">
            <div class="mb-4">
              <label for="accessSearchInput" class="block text-sm font-medium text-slate-700 mb-2">Buscar Estudiante para Registro</label>
              <div class="relative">
                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                <input id="accessSearchInput" type="text" placeholder="Escribe el nombre del estudiante..." class="w-full pl-9 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-teal-500 outline-none">
              </div>
            </div>
            <div id="accessSearchResults" class="space-y-2 mt-4"></div>
          </div>
          <!-- Historial Reciente -->
          <div class="bg-white rounded-xl shadow-sm border p-6">
            <h3 class="font-semibold mb-4 text-slate-700">√öltimos Movimientos</h3>
            <div id="accessRecentLog" class="space-y-3 text-sm"></div>
          </div>
        </div>
      </section>

      <!-- MODAL: Ver Estudiantes de Aula -->
      <div id="roomStudentsModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-semibold flex items-center gap-2">
              <i data-lucide="users" class="w-5 h-5 text-slate-600"></i>
              <span id="roomStudentsTitle">Estudiantes</span>
            </h3>
            <button id="btnCloseRoomStudentsX" class="text-slate-400 hover:text-slate-600"><i data-lucide="x" class="w-5 h-5"></i></button>
          </div>
          <div id="roomStudentsList" class="space-y-2 max-h-80 overflow-y-auto"></div>
          <div class="flex justify-end mt-4">
            <button id="btnCloseRoomStudents" class="px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200">Cerrar</button>
          </div>
        </div>
      </div>

      <!-- MODAL: Crear/Editar Aula -->
      <div id="roomModal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg">
          <h3 class="font-semibold mb-3 flex items-center gap-2">
            <i data-lucide="home" class="w-5 h-5"></i>
            <span id="roomModalTitle">Gestionar Aula</span>
          </h3>
          <input type="hidden" id="roomId">
          <div class="grid gap-3">
            <div>
              <label class="text-sm text-slate-600 block mb-1">Nombre del Aula</label>
              <input id="roomName" placeholder="Ej: Aula Peque√±os A1" class="w-full border rounded px-3 py-2" />
            </div>
            <div>
              <label class="text-sm text-slate-600 block mb-1">Maestro Asignado</label>
              <select id="roomTeacher" class="w-full border rounded px-3 py-2">
                <option value="">Seleccionar maestro...</option>
              </select>
            </div>
            <div>
              <label class="text-sm text-slate-600 block mb-1">Capacidad M√°xima</label>
              <input id="roomCapacity" type="number" min="1" max="30" placeholder="Ej: 15" class="w-full border rounded px-3 py-2" />
            </div>
            <div>
              <label class="text-sm text-slate-600 block mb-1">Estudiantes Asignados</label>
              <div class="border rounded px-3 py-2 max-h-40 overflow-y-auto bg-slate-50">
                <div id="roomStudentsChecklist" class="space-y-1 p-1"></div>
              </div>
              <p class="text-xs text-slate-500 mt-1">Selecciona los estudiantes que pertenecer√°n a esta aula</p>
            </div>
            <div class="flex justify-end gap-2 mt-3">
              <button id="btnCancelRoom" class="px-4 py-2 border rounded-lg hover:bg-slate-50">Cancelar</button>
              <button id="btnSaveRoom" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">Guardar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- PAGOS -->
      <section id="pagos" class="section">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold flex items-center gap-2 text-slate-700">
            <i data-lucide="credit-card" class="text-slate-500"></i> Gesti√≥n de Pagos
          </h2>
          <div class="flex gap-2">
            <div class="relative hidden md:block">
              <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
              <input id="searchPaymentInput" type="text" placeholder="Buscar por alumno, monto..." class="pl-9 pr-4 py-2 border rounded-lg text-sm w-64 focus:ring-2 focus:ring-teal-500 outline-none">
            </div>
            <select id="paymentMonthFilter" class="border rounded-lg px-3 py-2 text-sm bg-white focus:ring-2 focus:ring-teal-500 outline-none">
              <!-- Opciones de meses pobladas por JS -->
            </select>
            <button id="btnExportPayments" class="bg-slate-800 text-white px-4 py-2 rounded-lg hover:bg-slate-900 transition-colors text-sm font-medium flex items-center gap-2">
              <i data-lucide="download" class="w-4 h-4"></i> Exportar Excel
            </button>
            <button id="btnNewPayment" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium flex items-center gap-2">
              <i data-lucide="plus" class="w-4 h-4"></i> Registrar Pago
            </button>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border p-6 mb-6">
          <h3 class="font-bold text-lg mb-4 text-slate-700">Ingresos por Mes (Anual)</h3>
          <div class="relative h-64 w-full">
            <canvas id="incomeChart"></canvas>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border p-4 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold">Recordatorios de Pago</h3>
            <button id="btnSendReminders" class="px-3 py-2 rounded bg-amber-600 text-white text-sm hover:bg-amber-700 transition-colors flex items-center gap-2"><i data-lucide="send" class="w-4 h-4"></i> Enviar recordatorios pendientes</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <div>
              <label class="text-sm text-slate-600">D√≠a del mes</label>
              <input id="reminderDay" type="number" min="1" max="28" class="w-full border rounded px-3 py-2" placeholder="Ej: 5" />
            </div>
            <div class="md:col-span-2">
              <label class="text-sm text-slate-600">Mensaje</label>
              <input id="reminderMessage" class="w-full border rounded px-3 py-2" placeholder="Ej: Recuerde enviar su pago mensual para evitar recargos." />
            </div>
          </div>
          <div class="flex justify-end mt-3">
            <button id="btnSaveReminder" class="px-3 py-2 rounded bg-teal-600 text-white text-sm hover:bg-teal-700">Guardar Configuraci√≥n</button>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border overflow-hidden">
          <div class="overflow-x-auto">
          <table class="w-full text-sm text-left">
            <thead class="bg-slate-50 text-slate-500 font-medium">
              <tr>
                <th class="px-6 py-4">Estudiante</th>
                <th class="px-6 py-4">Monto</th>
                <th class="px-6 py-4">M√©todo</th>
                <th class="px-6 py-4">Estado</th>
                <th class="px-6 py-4">Banco</th>
                <th class="px-6 py-4">Referencia</th>
                <th class="px-6 py-4">Fecha</th>
                <th class="px-6 py-4">Mes</th>
                <th class="px-6 py-4">Evidencia</th>
                <th class="px-6 py-4">Acciones</th>
              </tr>
            </thead>
            <tbody id="paymentsTableBody" class="divide-y divide-slate-100">
              <!-- Ejemplo de fila para guiar implementaci√≥n JS -->
              <tr>
                <td class="px-6 py-4">Juan P√©rez</td>
                <td class="px-6 py-4">$1500.00</td>
                <td class="px-6 py-4">Transferencia</td>
                <td class="px-6 py-4"><span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pendiente</span></td>
                <td class="px-6 py-4">-</td>
                <td class="px-6 py-4">-</td>
              </tr>
            </tbody>
          </table>
          </div>
        </div>
      </section>

      <!-- PERFIL (Nueva Secci√≥n) -->
      <section id="perfil" class="section">
        <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
          <i data-lucide="user-cog" class="text-teal-600"></i> Mi Perfil Profesional
        </h2>
        <div class="w-full">
            <div class="bg-white rounded-3xl shadow-lg border border-slate-100 overflow-hidden">
                <!-- Banner / Header visual -->
                <div class="h-32 bg-gradient-to-r from-teal-500 to-emerald-600 relative">
                    <div class="absolute -bottom-12 left-8">
                        <div class="w-24 h-24 rounded-full border-4 border-white shadow-md overflow-hidden bg-white">
                            <img id="profileAvatarPreview" src="img/1.jpg" class="w-full h-full object-cover">
                        </div>
                        <label for="profileAvatarInput" class="absolute bottom-0 right-0 bg-slate-800 text-white p-1.5 rounded-full cursor-pointer hover:bg-slate-700 shadow-sm transition-transform hover:scale-110">
                            <i data-lucide="camera" class="w-4 h-4"></i>
                        </label>
                        <input type="file" id="profileAvatarInput" class="hidden" accept="image/*">
                    </div>
                </div>
                
                <div class="pt-16 px-8 pb-8">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800" id="profileNameDisplay">Asistente</h2>
                            <p class="text-slate-500 font-medium">Personal Administrativo</p>
                        </div>
                    </div>

                    <form id="profileForm" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Inputs -->
                        <div class="space-y-4">
                            <div><label class="block text-sm font-bold text-slate-700 mb-1">Nombre Completo</label><input id="profileName" type="text" class="w-full border border-slate-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50 focus:bg-white transition-all"></div>
                            <div><label class="block text-sm font-bold text-slate-700 mb-1">Tel√©fono</label><input id="profilePhone" type="tel" class="w-full border border-slate-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50 focus:bg-white transition-all"></div>
                            <div><label class="block text-sm font-bold text-slate-700 mb-1">Correo Electr√≥nico</label><input id="profileEmail" type="email" class="w-full border border-slate-200 rounded-xl px-4 py-3 bg-slate-100 text-slate-500 cursor-not-allowed" readonly></div>
                        </div>
                        <div class="space-y-4">
                            <div><label class="block text-sm font-bold text-slate-700 mb-1">Presentaci√≥n / Biograf√≠a</label><textarea id="profileBio" rows="5" class="w-full border border-slate-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-teal-500 outline-none bg-slate-50 focus:bg-white transition-all resize-none" placeholder="Escribe una breve descripci√≥n..."></textarea></div>
                            <div class="flex justify-end pt-2">
                                <button type="submit" class="bg-teal-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-teal-700 transition-all shadow-lg shadow-teal-200 active:scale-95 flex items-center gap-2">
                                    <i data-lucide="save" class="w-5 h-5"></i> Guardar Cambios
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
      </section>

    </main>
  </div>

  <!-- MODAL: Agregar Estudiante -->
  <div id="modalAddStudent" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg overflow-y-auto max-h-[90vh]">
      <h3 class="font-semibold mb-3 flex items-center gap-2">
        <i data-lucide="user-plus" class="w-5 h-5 text-teal-600"></i>
        <span id="modalStudentTitle">Agregar Estudiante</span>
      </h3>
      <div class="grid gap-3">
        <input type="hidden" id="stId">
            <input type="hidden" id="stParentId">
        <div>
          <label class="text-sm text-slate-600 block mb-1">Nombre del ni√±o</label>
          <input id="stName" placeholder="Ej: Juan P√©rez" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div>
            <label class="text-sm text-slate-600 block mb-1">Edad</label>
            <input id="stAge" type="number" min="0" placeholder="Edad" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          </div>
          <div>
            <label class="text-sm text-slate-600 block mb-1">Horario</label>
            <input id="stSchedule" placeholder="08:00-12:00" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          </div>
          <div class="col-span-2">
             <label class="text-sm text-slate-600 block mb-1">Aula Asignada</label>
             <select id="stClassroom" class="w-full border rounded px-3 py-2 bg-white focus:ring-2 focus:ring-teal-500 outline-none">
                <option value="">-- Seleccionar Aula --</option>
             </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <input id="p1Name" placeholder="Padre/Madre 1 (nombre)" class="border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          <input id="p1Phone" placeholder="Tel√©fono 1" class="border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          <input id="p1Email" type="email" placeholder="Correo (Usuario de acceso)" class="border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          <input id="p1Password" type="text" placeholder="Contrase√±a de acceso" class="border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
        </div>
        <div class="grid grid-cols-2 gap-2">
          <input id="p2Name" placeholder="Padre/Madre 2 (nombre)" class="border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          <input id="p2Phone" placeholder="Tel√©fono 2" class="border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
        </div>
        <div class="grid grid-cols-2 gap-2">
          <input id="stAllergies" placeholder="Alergias" class="border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          <input id="stBlood" placeholder="Tipo de Sangre" class="border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
        </div>
        <div>
          <label class="text-sm text-slate-600 block mb-1">Personas autorizadas para recoger</label>
          <input id="stPickup" placeholder="Ej: Abuela Carmen, T√≠o Juan" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
        </div>
        <label class="flex items-center gap-2"><input id="stActive" type="checkbox" checked class="rounded text-teal-600 focus:ring-teal-500" /> Estudiante activo</label>
        <div class="flex justify-end gap-2 mt-3">
          <button id="btnCancelStudent" class="px-4 py-2 border rounded-lg hover:bg-slate-50">Cancelar</button>
          <button id="btnSaveStudent" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Detalle de Pago (Validaci√≥n) -->
  <div id="paymentDetailModal" class="fixed inset-0 bg-black/30 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-slate-800">Validaci√≥n de Pago</h3>
        <button class="close-modal-btn p-1 rounded-full hover:bg-slate-100"><i data-lucide="x"></i></button>
      </div>
      <div class="space-y-3 mb-6">
        <div class="flex justify-between border-b pb-2">
          <span class="text-slate-500">Estudiante:</span>
          <span class="font-medium" id="pdStudent">-</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-slate-500">Monto:</span>
          <span class="font-bold text-lg" id="pdAmount">-</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-slate-500">Estado actual:</span>
          <span class="font-bold" id="pdStatus">-</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-slate-500">Referencia:</span>
          <span class="font-mono text-sm" id="pdRef">-</span>
        </div>
      </div>
      <div id="pdActions" class="flex gap-3 justify-end">
        <!-- Botones inyectados por JS -->
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/common_ui.js"></script>
  <script type="module" src="js/panel_asistente.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(console.error);
    }
  </script>

  <!-- Payment Modal -->
  <div id="paymentModal" class="fixed inset-0 bg-black/30 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-lg font-bold">Registrar Nuevo Pago</h3>
        <button id="closePaymentModal" class="p-1 rounded-full hover:bg-slate-100"><i data-lucide="x"></i></button>
      </div>
      <form id="paymentForm">
        <div class="space-y-4">
          <div>
            <label for="studentSelect" class="block text-sm font-medium text-slate-600 mb-1">Estudiante</label>
            <select id="studentSelect" required class="w-full border-slate-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-teal-500"></select>
          </div>
          <div>
            <label for="paymentAmount" class="block text-sm font-medium text-slate-600 mb-1">Monto</label>
            <input type="number" id="paymentAmount" required class="w-full border-slate-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-teal-500" placeholder="Ej: 1500">
          </div>
          <div>
            <label for="paymentMonth" class="block text-sm font-medium text-slate-600 mb-1">Mes Pagado</label>
            <select id="paymentMonth" required class="w-full border-slate-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-teal-500">
              <option value="Enero">Enero</option>
              <option value="Febrero">Febrero</option>
              <option value="Marzo">Marzo</option>
              <option value="Abril">Abril</option>
              <option value="Mayo">Mayo</option>
              <option value="Junio">Junio</option>
              <option value="Julio">Julio</option>
              <option value="Agosto">Agosto</option>
              <option value="Septiembre">Septiembre</option>
              <option value="Octubre">Octubre</option>
              <option value="Noviembre">Noviembre</option>
              <option value="Diciembre">Diciembre</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-600 mb-1">M√©todo</label>
            <select id="paymentMethod" class="w-full border-slate-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-teal-500">
              <option value="transferencia">Transferencia</option>
              <option value="efectivo">Efectivo</option>
            </select>
          </div>
          <div id="transferFields">
            <div>
              <label class="block text-sm text-slate-600 mb-1">Banco</label>
              <input id="paymentBank" class="w-full border-slate-300 rounded-lg shadow-sm" placeholder="Banco">
            </div>
            <div>
              <label class="block text-sm text-slate-600 mb-1">Referencia</label>
              <input id="paymentRef" class="w-full border-slate-300 rounded-lg shadow-sm" placeholder="0000000000">
            </div>
            <div>
              <label class="block text-sm text-slate-600 mb-1">Fecha de transferencia</label>
              <input type="date" id="paymentDate" class="w-full border-slate-300 rounded-lg shadow-sm">
            </div>
            <div>
              <label class="block text-sm text-slate-600 mb-1">Evidencia</label>
              <input type="file" id="paymentEvidence" accept="image/*" class="w-full border-slate-300 rounded-lg shadow-sm">
            </div>
          </div>
          <div class="pt-4 flex justify-end gap-3">
            <button type="button" id="cancelPayment" class="px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm font-medium">Cancelar</button>
            <button type="submit" class="px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700 text-sm font-medium">Guardar Pago</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <!-- Attendance Modal -->
  <div id="attendanceModal" class="fixed inset-0 bg-black/30 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-4xl h-[80vh] flex flex-col">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h3 class="text-lg font-bold" id="attModalTitle">Asistencia - Aula</h3>
          <p class="text-sm text-slate-500" id="attModalDate">Fecha: Hoy</p>
        </div>
        <button id="closeAttendanceModal" class="p-2 rounded-full hover:bg-slate-100"><i data-lucide="x"></i></button>
      </div>
      
      <div class="flex-1 overflow-y-auto">
        <table class="w-full text-sm text-left border-collapse">
          <thead class="bg-slate-50 text-slate-500 sticky top-0">
            <tr>
              <th class="p-3">Estudiante</th>
              <th class="p-3 text-center">Estado</th>
              <th class="p-3 text-center">Hora</th>
            </tr>
          </thead>
          <tbody id="attModalBody" class="divide-y divide-slate-100">
            <!-- JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Access Authorization Modal -->
  <div id="accessModal" class="fixed inset-0 bg-black/30 z-50 hidden items-center justify-center" style="-webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden">
      <div class="px-6 py-4 border-b">
        <h3 class="text-lg font-bold text-slate-800">Confirmar salida</h3>
        <p class="text-sm text-slate-500">Ingrese el nombre de la persona autorizada para recoger</p>
      </div>
      <div class="px-6 py-4 space-y-3">
        <label for="accessPersonInput" class="text-sm text-slate-600">Persona autorizada</label>
        <input id="accessPersonInput" type="text" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Nombre completo" />
      </div>
      <div class="px-6 py-4 bg-slate-50 flex justify-end gap-2">
        <button id="cancelAccessBtn" class="px-4 py-2 rounded-lg border hover:bg-slate-100">Cancelar</button>
        <button id="confirmAccessBtn" class="px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Modal Crear/Editar Maestro -->
  <div id="modalAddTeacher" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 backdrop-blur-sm p-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md">
      <div class="p-6 border-b flex justify-between items-center">
        <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
          <i data-lucide="user-plus" class="w-5 h-5 text-teal-600"></i>
          <span id="teacherModalTitle">Agregar Maestro</span>
        </h3>
        <button id="btnCancelTeacher" class="text-slate-400 hover:text-slate-600 transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
      </div>
      <div class="p-6 space-y-4">
          <input type="hidden" id="teacherId">
          <div>
              <label class="text-sm font-medium text-slate-700 block mb-1">Nombre completo *</label>
              <input id="teacherName" placeholder="Ej: Carlos Rivas" class="w-full border border-slate-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          </div>
          <div>
              <label class="text-sm font-medium text-slate-700 block mb-1">Correo (Usuario) *</label>
              <input id="teacherEmail" type="email" placeholder="Ej: carlos@karpus.com" class="w-full border border-slate-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          </div>
          <div>
              <label class="text-sm font-medium text-slate-700 block mb-1">Contrase√±a <span id="passHint" class="text-xs font-normal text-slate-400">(Requerida para nuevos)</span></label>
              <input id="teacherPassword" type="text" placeholder="M√≠nimo 6 caracteres" class="w-full border border-slate-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          </div>
          <div>
              <label class="text-sm font-medium text-slate-700 block mb-1">Tel√©fono</label>
              <input id="teacherPhone" placeholder="Ej: 809-555-0000" class="w-full border border-slate-300 rounded-xl px-3 py-2 focus:ring-2 focus:ring-teal-500 outline-none" />
          </div>
      </div>
      <div class="p-6 border-t bg-slate-50 rounded-b-2xl flex justify-end gap-3">
        <button id="btnCancelTeacherFooter" class="px-5 py-2.5 border border-slate-300 rounded-xl text-slate-700 font-medium hover:bg-white transition-colors">Cancelar</button>
        <button id="btnSaveTeacher" class="px-5 py-2.5 bg-teal-600 text-white rounded-xl font-bold shadow-lg shadow-teal-200 hover:bg-teal-700 transition-all">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toastNotification" class="fixed bottom-6 right-6 bg-slate-800 text-white px-6 py-3 rounded-xl shadow-lg transform transition-all duration-300 translate-y-20 opacity-0 z-50">
    Notificaci√≥n
  </div>
</body>
</html>
