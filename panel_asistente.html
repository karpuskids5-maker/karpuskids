<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karpus Kids ‚Äî Panel Asistente</title>
  <link rel="icon" href="./logo/favicon.ico" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.562.0/dist/umd/lucide.min.js"></script>
  <script>
    (function(){
      if(!(window.lucide && typeof lucide.createIcons==='function')){
        var s=document.createElement('script');
        s.src='https://unpkg.com/lucide@0.562.0/dist/umd/lucide.min.js';
        s.async=true;document.head.appendChild(s);
      }
    })();
  </script>
  
  <style>
    #sidebar { transform: translateX(-100%); transition: transform .3s ease; }
    #sidebar.show { transform: translateX(0); }
    @media (min-width: 768px) { #sidebar { transform: translateX(0); } }

    /* Sidebar styles */
    #sidebar.collapsed {
      transform: translateX(0) !important;
    }
    aside#sidebar { 
      width: 280px; 
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
      z-index: 50;
      overflow: hidden;
    }
    aside#sidebar.collapsed { width: 80px; }
    
    /* Sidebar Content Transitions */
    aside#sidebar .label { 
      opacity: 1; 
      transition: opacity 0.2s ease, transform 0.2s ease; 
      white-space: nowrap;
      margin-left: 12px;
    }
    aside#sidebar.collapsed .label { opacity: 0; width: 0; margin-left: 0; pointer-events: none; }
    
    /* Centrado de iconos cuando est√° colapsado */
    aside#sidebar.collapsed .nav-btn { justify-content: center; padding-left: 0; padding-right: 0; }
    aside#sidebar.collapsed .nav-btn i { margin: 0; }

    /* Hover expand logic */
    aside#sidebar.collapsed:hover { width: 280px; }
    aside#sidebar.collapsed:hover .label { opacity: 1; width: auto; margin-left: 12px; pointer-events: auto; }
    aside#sidebar.collapsed:hover .nav-btn { justify-content: flex-start; padding-left: 1rem; padding-right: 1rem; }

    /* Tema Asistente (Teal/Turquesa) */
    .sidebar-teal { background: linear-gradient(135deg, #0f766e, #115e59); }
    
    /* Layout adjustments */
    #layoutShell { transition: margin-left .25s ease; }
    @media (min-width: 768px) { #layoutShell { margin-left: 280px; } }
    #layoutShell.sidebar-collapsed { margin-left: 80px !important; }
    
    /* View Transitions */
    .section {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .section.active {
      display: block;
      opacity: 1;
      animation: fadeIn 0.4s ease-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      #layoutShell { margin-left: 0 !important; }
    }
    #attendanceModal { -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px); }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
  <div class="min-h-screen flex">
    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar-teal p-4 rounded-r-3xl shadow-lg fixed inset-y-0 left-0 z-10">
      <button id="toggleSidebar" class="absolute -right-3 top-6 bg-white rounded-full p-1 shadow-md border border-slate-100 text-slate-500 hover:text-teal-600 hidden md:block"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
      <div class="flex items-center gap-3 mb-8">
        <div class="h-10 w-10 rounded-xl bg-white/20 flex items-center justify-center shadow-lg text-white font-bold">
          K
        </div>
        <div class="label">
          <h3 class="font-semibold text-white karpus-kids-inline">
            <span class="k-1">K</span><span class="k-2">a</span><span class="k-3">r</span><span class="k-4">p</span><span class="k-5">u</span><span class="k-6">s</span> <span class="k-7">K</span><span class="k-8">i</span><span class="k-9">d</span><span class="k-10">s</span>
          </h3>
          <p class="text-xs text-white text-opacity-80">Panel Asistente</p>
        </div>
      </div>

      <nav class="space-y-2 bg-white/10 p-2 rounded-xl mb-4">
        <button data-section="dashboard" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="layout-dashboard"></i>
          <span class="label">Resumen</span>
        </button>
        <button data-section="estudiantes" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="users"></i>
          <span class="label">Estudiantes</span>
        </button>
        <button data-section="maestros" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="graduation-cap"></i>
          <span class="label">Maestros</span>
        </button>
        <button data-section="accesos" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="door-open"></i>
          <span class="label">Accesos</span>
        </button>
        <button data-section="pagos" class="nav-btn w-full flex items-center p-3 rounded-lg text-white hover:bg-white/20 transition-colors">
          <i data-lucide="credit-card"></i>
          <span class="label">Pagos</span>
        </button>
      </nav>

      <div class="mt-auto absolute bottom-6 left-4 right-4 text-xs text-white/80 label">
        <p>Usuario: <span class="font-medium" id="sidebarUserName">Cargando...</span></p>
        <button id="btnLogout" class="mt-2 flex items-center gap-2 hover:text-white transition-colors"><i data-lucide="log-out" class="w-3 h-3"></i> Cerrar Sesi√≥n</button>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="flex-1 p-6" id="layoutShell">
      <!-- Mobile Header -->
      <div class="md:hidden mb-6 flex items-center justify-between">
        <button id="menuBtn" class="p-2 rounded bg-white shadow"><i data-lucide="menu"></i></button>
        <h2 class="font-semibold text-teal-700">Panel Asistente</h2>
        <div class="w-8"></div>
      </div>

      <!-- SECTIONS -->
      
      <!-- DASHBOARD -->
      <section id="dashboard" class="section active">
        <h1 class="text-2xl font-bold mb-6 text-slate-800">Hola, <span id="welcomeName">Asistente</span> üëã</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card-interactive">
            <div class="flex items-center gap-4">
              <div class="p-3 bg-blue-100 text-blue-600 rounded-xl"><i data-lucide="users" class="w-6 h-6"></i></div>
              <div>
                <p class="text-sm text-slate-500">Estudiantes Activos</p>
                <p class="text-3xl font-bold text-blue-800" id="statStudents">-</p>
              </div>
            </div>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card-interactive">
            <div class="flex items-center gap-4">
              <div class="p-3 bg-green-100 text-green-600 rounded-xl"><i data-lucide="check-circle" class="w-6 h-6"></i></div>
              <div>
                <p class="text-sm text-slate-500">Asistencia Hoy</p>
                <p class="text-3xl font-bold text-green-800" id="statAttendance">-</p>
              </div>
            </div>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card-interactive">
            <div class="flex items-center gap-4">
              <div class="p-3 bg-orange-100 text-orange-600 rounded-xl"><i data-lucide="alert-circle" class="w-6 h-6"></i></div>
              <div>
                <p class="text-sm text-slate-500">Pagos Pendientes</p>
                <p class="text-3xl font-bold text-orange-800" id="statPayments">-</p>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 card-interactive">
          <h3 class="font-semibold mb-4">Accesos R√°pidos</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <button id="btnQuickStudents" class="p-4 rounded-xl bg-slate-50 hover:bg-blue-100 hover:text-blue-800 transition-colors text-center group">
              <i data-lucide="search" class="w-6 h-6 mx-auto mb-2 text-slate-500"></i>
              <span class="text-sm font-medium">Buscar Alumno</span>
            </button>
            <button id="btnQuickPayments" class="p-4 rounded-xl bg-slate-50 hover:bg-green-100 hover:text-green-800 transition-colors text-center group">
              <i data-lucide="dollar-sign" class="w-6 h-6 mx-auto mb-2 text-slate-500"></i>
              <span class="text-sm font-medium">Registrar Pago</span>
            </button>
          </div>
        </div>
      </section>

      <!-- ESTUDIANTES -->
      <section id="estudiantes" class="section">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold flex items-center gap-2 text-slate-700">
            <i data-lucide="users" class="text-slate-500"></i> Directorio de Estudiantes
          </h2>
          <div class="relative">
            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
            <input id="searchStudentInput" type="text" placeholder="Buscar..." class="pl-9 pr-4 py-2 border rounded-lg text-sm w-64">
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
          <table class="w-full text-sm text-left">
            <thead class="bg-slate-50 text-slate-500 font-medium">
              <tr>
                <th class="px-6 py-4">Nombre</th>
                <th class="px-6 py-4">Aula</th>
                <th class="px-6 py-4">Padre/Tutor</th>
                <th class="px-6 py-4">Estado</th>
              </tr>
            </thead>
            <tbody id="studentsTableBody" class="divide-y divide-slate-100">
              <!-- JS -->
            </tbody>
          </table>
        </div>
      </section>

      <section id="maestros" class="section">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold flex items-center gap-2 text-slate-700">
            <i data-lucide="graduation-cap" class="text-slate-500"></i> Gesti√≥n de Maestros
          </h2>
          <button id="btnNewTeacher" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i>Nuevo</button>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border overflow-hidden">
          <table class="w-full text-sm text-left">
            <thead class="bg-slate-50 text-slate-500 font-medium">
              <tr>
                <th class="px-6 py-4">Nombre</th>
                <th class="px-6 py-4">Correo</th>
                <th class="px-6 py-4">Tel√©fono</th>
                <th class="px-6 py-4">Acciones</th>
              </tr>
            </thead>
            <tbody id="teachersTableBody" class="divide-y divide-slate-100"></tbody>
          </table>
        </div>
      </section>

      <!-- ACCESOS (Check-in/Check-out) -->
      <section id="accesos" class="section">
        <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-slate-700">
          <i data-lucide="door-open" class="text-slate-500"></i> Control de Accesos (Check-in / Check-out)
        </h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Buscador y Acci√≥n -->
          <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border p-6">
            <div class="mb-4">
              <label for="accessSearchInput" class="block text-sm font-medium text-slate-700 mb-2">Buscar Estudiante para Registro</label>
              <div class="relative">
                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                <input id="accessSearchInput" type="text" placeholder="Escribe el nombre del estudiante..." class="w-full pl-9 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-teal-500 outline-none">
              </div>
            </div>
            <div id="accessSearchResults" class="space-y-2 mt-4"></div>
          </div>
          <!-- Historial Reciente -->
          <div class="bg-white rounded-xl shadow-sm border p-6">
            <h3 class="font-semibold mb-4 text-slate-700">√öltimos Movimientos</h3>
            <div id="accessRecentLog" class="space-y-3 text-sm"></div>
          </div>
        </div>
      </section>

      <!-- PAGOS -->
      <section id="pagos" class="section">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold flex items-center gap-2 text-slate-700">
            <i data-lucide="credit-card" class="text-slate-500"></i> Gesti√≥n de Pagos
          </h2>
          <div class="flex gap-2">
            <div class="relative hidden md:block">
              <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
              <input id="searchPaymentInput" type="text" placeholder="Buscar por alumno, monto..." class="pl-9 pr-4 py-2 border rounded-lg text-sm w-64 focus:ring-2 focus:ring-teal-500 outline-none">
            </div>
            <button id="btnExportPayments" class="bg-slate-800 text-white px-4 py-2 rounded-lg hover:bg-slate-900 transition-colors text-sm font-medium flex items-center gap-2">
              <i data-lucide="download" class="w-4 h-4"></i> Exportar Excel
            </button>
            <button id="btnNewPayment" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium flex items-center gap-2">
              <i data-lucide="plus" class="w-4 h-4"></i> Registrar Pago
            </button>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border p-4 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold">Recordatorios de Pago</h3>
            <button id="btnSendReminders" class="px-3 py-2 rounded bg-amber-600 text-white text-sm">Enviar ahora</button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <div>
              <label class="text-sm text-slate-600">D√≠a del mes</label>
              <input id="reminderDay" type="number" min="1" max="28" class="w-full border rounded px-3 py-2" placeholder="5" />
            </div>
            <div class="md:col-span-2">
              <label class="text-sm text-slate-600">Mensaje</label>
              <input id="reminderMessage" class="w-full border rounded px-3 py-2" placeholder="Recuerde enviar su pago mensual" />
            </div>
          </div>
          <div class="flex justify-end mt-3">
            <button id="btnSaveReminder" class="px-3 py-2 rounded bg-teal-600 text-white text-sm">Guardar</button>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border overflow-hidden">
          <div class="overflow-x-auto">
          <table class="w-full text-sm text-left">
            <thead class="bg-slate-50 text-slate-500 font-medium">
              <tr>
                <th class="px-6 py-4">Estudiante</th>
                <th class="px-6 py-4">Monto</th>
                <th class="px-6 py-4">M√©todo</th>
                <th class="px-6 py-4">Estado</th>
                <th class="px-6 py-4">Banco</th>
                <th class="px-6 py-4">Referencia</th>
                <th class="px-6 py-4">Fecha</th>
                <th class="px-6 py-4">Mes</th>
                <th class="px-6 py-4">Evidencia</th>
                <th class="px-6 py-4">Acciones</th>
              </tr>
            </thead>
            <tbody id="paymentsTableBody" class="divide-y divide-slate-100">
              <!-- Ejemplo de fila para guiar implementaci√≥n JS -->
              <tr>
                <td class="px-6 py-4">Juan P√©rez</td>
                <td class="px-6 py-4">$1500.00</td>
                <td class="px-6 py-4">Transferencia</td>
                <td class="px-6 py-4"><span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pendiente</span></td>
                <td class="px-6 py-4">-</td>
                <td class="px-6 py-4">-</td>
              </tr>
            </tbody>
          </table>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Modal Detalle de Pago (Validaci√≥n) -->
  <div id="paymentDetailModal" class="fixed inset-0 bg-black/30 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-slate-800">Validaci√≥n de Pago</h3>
        <button class="close-modal-btn p-1 rounded-full hover:bg-slate-100"><i data-lucide="x"></i></button>
      </div>
      <div class="space-y-3 mb-6">
        <div class="flex justify-between border-b pb-2">
          <span class="text-slate-500">Estudiante:</span>
          <span class="font-medium" id="pdStudent">-</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-slate-500">Monto:</span>
          <span class="font-bold text-lg" id="pdAmount">-</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-slate-500">Estado actual:</span>
          <span class="font-bold" id="pdStatus">-</span>
        </div>
        <div class="flex justify-between border-b pb-2">
          <span class="text-slate-500">Referencia:</span>
          <span class="font-mono text-sm" id="pdRef">-</span>
        </div>
      </div>
      <div id="pdActions" class="flex gap-3 justify-end">
        <!-- Botones inyectados por JS -->
      </div>
    </div>
  </div>

  <script type="module" src="js/panel_asistente.js"></script>

  <!-- Payment Modal -->
  <div id="paymentModal" class="fixed inset-0 bg-black/30 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-lg font-bold">Registrar Nuevo Pago</h3>
        <button id="closePaymentModal" class="p-1 rounded-full hover:bg-slate-100"><i data-lucide="x"></i></button>
      </div>
      <form id="paymentForm">
        <div class="space-y-4">
          <div>
            <label for="studentSelect" class="block text-sm font-medium text-slate-600 mb-1">Estudiante</label>
            <select id="studentSelect" required class="w-full border-slate-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-teal-500"></select>
          </div>
          <div>
            <label for="paymentAmount" class="block text-sm font-medium text-slate-600 mb-1">Monto</label>
            <input type="number" id="paymentAmount" required class="w-full border-slate-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-teal-500" placeholder="Ej: 1500">
          </div>
          <div>
            <label for="paymentMonth" class="block text-sm font-medium text-slate-600 mb-1">Mes Pagado</label>
            <select id="paymentMonth" required class="w-full border-slate-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-teal-500">
              <option value="Enero">Enero</option>
              <option value="Febrero">Febrero</option>
              <option value="Marzo">Marzo</option>
              <option value="Abril">Abril</option>
              <option value="Mayo">Mayo</option>
              <option value="Junio">Junio</option>
              <option value="Julio">Julio</option>
              <option value="Agosto">Agosto</option>
              <option value="Septiembre">Septiembre</option>
              <option value="Octubre">Octubre</option>
              <option value="Noviembre">Noviembre</option>
              <option value="Diciembre">Diciembre</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-600 mb-1">M√©todo</label>
            <select id="paymentMethod" class="w-full border-slate-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-teal-500">
              <option value="transferencia">Transferencia</option>
              <option value="efectivo">Efectivo</option>
            </select>
          </div>
          <div id="transferFields">
            <div>
              <label class="block text-sm text-slate-600 mb-1">Banco</label>
              <input id="paymentBank" class="w-full border-slate-300 rounded-lg shadow-sm" placeholder="Banco">
            </div>
            <div>
              <label class="block text-sm text-slate-600 mb-1">Referencia</label>
              <input id="paymentRef" class="w-full border-slate-300 rounded-lg shadow-sm" placeholder="0000000000">
            </div>
            <div>
              <label class="block text-sm text-slate-600 mb-1">Fecha de transferencia</label>
              <input type="date" id="paymentDate" class="w-full border-slate-300 rounded-lg shadow-sm">
            </div>
            <div>
              <label class="block text-sm text-slate-600 mb-1">Evidencia</label>
              <input type="file" id="paymentEvidence" accept="image/*" class="w-full border-slate-300 rounded-lg shadow-sm">
            </div>
          </div>
          <div class="pt-4 flex justify-end gap-3">
            <button type="button" id="cancelPayment" class="px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm font-medium">Cancelar</button>
            <button type="submit" class="px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700 text-sm font-medium">Guardar Pago</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <!-- Attendance Modal -->
  <div id="attendanceModal" class="fixed inset-0 bg-black/30 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-4xl h-[80vh] flex flex-col">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h3 class="text-lg font-bold" id="attModalTitle">Asistencia - Aula</h3>
          <p class="text-sm text-slate-500" id="attModalDate">Fecha: Hoy</p>
        </div>
        <button id="closeAttendanceModal" class="p-2 rounded-full hover:bg-slate-100"><i data-lucide="x"></i></button>
      </div>
      
      <div class="flex-1 overflow-y-auto">
        <table class="w-full text-sm text-left border-collapse">
          <thead class="bg-slate-50 text-slate-500 sticky top-0">
            <tr>
              <th class="p-3">Estudiante</th>
              <th class="p-3 text-center">Estado</th>
              <th class="p-3 text-center">Hora</th>
            </tr>
          </thead>
          <tbody id="attModalBody" class="divide-y divide-slate-100">
            <!-- JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Access Authorization Modal -->
  <div id="accessModal" class="fixed inset-0 bg-black/30 z-50 hidden items-center justify-center" style="-webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden">
      <div class="px-6 py-4 border-b">
        <h3 class="text-lg font-bold text-slate-800">Confirmar salida</h3>
        <p class="text-sm text-slate-500">Ingrese el nombre de la persona autorizada para recoger</p>
      </div>
      <div class="px-6 py-4 space-y-3">
        <label for="accessPersonInput" class="text-sm text-slate-600">Persona autorizada</label>
        <input id="accessPersonInput" type="text" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Nombre completo" />
      </div>
      <div class="px-6 py-4 bg-slate-50 flex justify-end gap-2">
        <button id="cancelAccessBtn" class="px-4 py-2 rounded-lg border hover:bg-slate-100">Cancelar</button>
        <button id="confirmAccessBtn" class="px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700">Confirmar</button>
      </div>
    </div>
  </div>
</body>
</html>
