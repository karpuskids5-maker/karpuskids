<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Padres - Karpus Kids</title>
  <link rel="icon" href="./logo/favicon.ico" type="image/x-icon" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="./css/karpus-tailwind.css" rel="stylesheet">
  <script src="https://unpkg.com/lucide@0.562.0/dist/umd/lucide.js"></script>
  <style>
    :root{--color-primary:#3B82F6;--color-hover:#BFDBFE;--color-bg:#F8FAFC;--color-card:#FFFFFF;--color-text:#1E293B;--color-success:#22C55E;--color-warning:#FACC15;--color-error:#EF4444}
    body{background:var(--color-bg);color:var(--color-text)}
    .section{display:none;opacity:0;transition:opacity .3s ease}
    .section.active{display:block;opacity:1}
    img{max-width:100%;height:auto}
    #classFeed img,#feed img{max-width:100%;max-height:400px;object-fit:contain;border-radius:12px}
    aside img,header img{width:40px;height:40px;object-fit:cover}
    #layoutShell{transition:margin-left .25s ease}
    #layoutShell.sidebar-collapsed{margin-left:72px!important}
    @media (max-width:768px){#layoutShell{margin-left:0!important}}
    /* Sidebar list style */
    .sidebar-btn{display:flex;align-items:center;gap:.75rem;width:100%;padding:.5rem .75rem;border-radius:.75rem;color:var(--color-text)}
    .sidebar-btn i{color:var(--color-primary)}
    .sidebar-btn:hover{background:var(--color-hover)}
    .sidebar-btn.active{background:var(--color-hover);font-weight:600}
    /* Collapsible sidebar */
    #sidebar.collapsed{width:64px}
    #sidebar.collapsed .label{display:none}
    #sidebar.collapsed .sidebar-btn{justify-content:center}
    #sidebar.collapsed .sidebar-btn .label{display:none}
    #sidebar.collapsed.hover-open{width:260px}
    #sidebar.collapsed.hover-open .label{display:block}
    #sidebar.collapsed.hover-open .sidebar-btn{justify-content:flex-start}
    #sidebar.collapsed.hover-open .sidebar-btn .label{display:inline}
    /* Karpus colored letters small */
    .karpus-kids-inline{font-weight:700}
    .karpus-kids-inline .k-1{color:#FF9800}
    .karpus-kids-inline .k-2{color:#2196F3}
    .karpus-kids-inline .k-3{color:#E91E63}
    .karpus-kids-inline .k-4{color:#4CAF50}
    .karpus-kids-inline .k-5{color:#FF9800}
    .karpus-kids-inline .k-6{color:#2196F3}
    .karpus-kids-inline .k-7{color:#4CAF50}
    .karpus-kids-inline .k-8{color:#E91E63}
    .karpus-kids-inline .k-9{color:#2196F3}
    .karpus-kids-inline .k-10{color:#FF9800}
  </style>
</head>
<body class="text-slate-800 min-h-screen">
  <div class="flex min-h-screen font-nunito overflow-hidden">
    <aside id="sidebar" class="hidden md:flex flex-col w-[260px] bg-white border-r shadow-sm px-4 py-6 fixed inset-y-0 left-0 z-20">
      <button id="toggleSidebar" class="absolute right-2 top-6 bg-white border rounded-full w-8 h-8 flex items-center justify-center shadow-md hidden md:flex"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
      <div class="flex items-center gap-3 mb-8">
        <img src="img/mundo.jpg" class="w-10 h-10 rounded-xl" />
        <div class="label">
          <p class="text-sm karpus-kids-inline">
            <span class="k-1">K</span><span class="k-2">a</span><span class="k-3">r</span><span class="k-4">p</span><span class="k-5">u</span><span class="k-6">s</span>
            <span class="k-7">K</span><span class="k-8">i</span><span class="k-9">d</span><span class="k-10">s</span>
          </p>
          <p class="text-xs text-slate-500 role-display">Padre/Tutor</p>
        </div>
      </div>
      <nav class="space-y-1" role="navigation" aria-label="Menú principal">
        <button data-target="home" class="sidebar-btn nav-btn text-base active"><i data-lucide="layout-grid" class="w-6 h-6"></i><span class="label">Inicio</span></button>
        <button data-target="live-attendance" class="sidebar-btn nav-btn text-base"><i data-lucide="calendar-check" class="w-6 h-6"></i><span class="label">Asistencia</span></button>
        <button data-target="class" class="sidebar-btn nav-btn text-base"><i data-lucide="school" class="w-6 h-6"></i><span class="label">Aula</span></button>
        <button data-target="tasks" class="sidebar-btn nav-btn text-base"><i data-lucide="clipboard-list" class="w-6 h-6"></i><span class="label">Tareas</span></button>
        <button data-target="notifications" class="sidebar-btn nav-btn text-base"><i data-lucide="message-circle" class="w-6 h-6"></i><span class="label">Mensajes</span></button>
        <button data-target="payments" class="sidebar-btn nav-btn text-base"><i data-lucide="credit-card" class="w-6 h-6"></i><span class="label">Pagos</span></button>
        <button data-target="profile" class="sidebar-btn nav-btn text-base"><i data-lucide="heart-handshake" class="w-6 h-6"></i><span class="label">Perfil</span></button>
      </nav>
      <div class="mt-auto text-xs text-slate-400 label">
        Supervisando a:<br>
        <strong id="sidebar-student-name">...</strong>
      </div>
    </aside>
    <div id="sidebarOverlay" class="fixed inset-0 bg-black/40 z-10 hidden md:hidden"></div>
    <div id="layoutShell" class="flex-1 flex flex-col md:ml-[260px]">
      <div class="md:hidden w-full fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-sm border-b z-10 shadow-lg">
        <header class="px-4 py-2 flex items-center justify-between">
          <button id="menuBtn" class="p-2 -ml-2 rounded-lg text-slate-600 hover:bg-slate-100"><i data-lucide="menu" class="w-6 h-6"></i></button>
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-2xl bg-pink-100 flex items-center justify-center shadow-lg">
              <img src="img/mundo.jpg" alt="logo" class="h-6 w-6 rounded" />
            </div>
            <div>
              <h1 class="text-lg font-semibold karpus-kids-inline">
                <span class="k-1">K</span><span class="k-2">a</span><span class="k-3">r</span><span class="k-4">p</span><span class="k-5">u</span><span class="k-6">s</span>
                <span class="k-7">K</span><span class="k-8">i</span><span class="k-9">d</span><span class="k-10">s</span>
              </h1>
              <p class="text-xs text-slate-500">Supervisando a: <span id="mobile-student-name">...</span></p>
            </div>
          </div>
          <div class="w-8"></div>
        </header>
      </div>
      <main class="flex-1 px-4 space-y-6 md:pt-6 mt-16 md:mt-0 pb-6" id="parent-main">
        <section id="home" class="section active space-y-6">
          <div class="p-4 rounded-3xl bg-white border shadow-sm">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-lg font-bold text-slate-800"></h2>
                <p class="text-sm text-slate-500">Estudiante: <span class="student-name-display font-semibold text-blue-600">—</span> • Padres: <span class="guardian-name-display font-semibold">—</span></p>
              </div>
              <div class="text-right space-y-1">
                <p class="text-xs text-slate-400" id="currentDateDisplay">Hoy</p>
                <span class="block text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full">Curso/Aula: <span class="classroom-name-display">—</span></span>
              </div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-white p-3 rounded-3xl border shadow-sm">
              <div class="flex items-center gap-2 mb-2"><div class="p-1.5 bg-green-100 text-green-600 rounded-lg"><i data-lucide="check-circle" class="w-5 h-5"></i></div><span class="text-xs font-semibold text-slate-600">Asistencia</span></div>
              <p class="text-2xl font-bold text-slate-800" id="dashAttendance">0%</p>
            </div>
            <div class="bg-white p-3 rounded-3xl border shadow-sm">
              <div class="flex items-center gap-2 mb-2"><div class="p-1.5 bg-orange-100 text-orange-600 rounded-lg"><i data-lucide="pencil" class="w-5 h-5"></i></div><span class="text-xs font-semibold text-slate-600">Tareas</span></div>
              <p class="text-2xl font-bold text-slate-800" id="dashPendingTasks">0</p>
            </div>
          </div>
          <div class="mt-3 flex items-center justify-between bg-white p-3 rounded-3xl border shadow-sm">
            <div class="flex items-center gap-2"><div class="p-1.5 bg-amber-100 text-amber-600 rounded-lg"><i data-lucide="list-checks" class="w-5 h-5"></i></div><span class="text-sm font-semibold text-slate-700">Actividades pendientes y evidencias</span></div>
            <button id="ctaPendingBtn" class="text-sm px-3 py-1 rounded-xl" style="background:#FACC15;color:#1F2937;box-shadow:0 3px 8px rgba(250,204,21,.25)"><i data-lucide="arrow-right" class="w-4 h-4 inline-block align-middle"></i><span class="align-middle">Ver Actividades</span></button>
          </div>
        </section>
        <section id="live-attendance" class="section space-y-6">
          <div class="flex items-center justify-between"><h2 class="text-base font-semibold flex items-center gap-2"><i data-lucide="calendar" class="w-5 h-5 text-green-600"></i><span>Calendario</span></h2><div class="flex gap-2"><button id="calPrevBtn" class="px-2 py-1 border rounded">Mes anterior</button><button id="calNextBtn" class="px-2 py-1 border rounded">Mes siguiente</button></div></div>
          <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
        </section>
        <section id="class" class="section space-y-4">
          <div class="flex items-center justify-between"><h2 class="text-base font-semibold flex items-center gap-2"><i data-lucide="layout-dashboard" class="w-5 h-5 text-green-600"></i><span>Muro del Aula</span></h2><span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-500">Solo lectura</span></div>
          <div id="classFeed" class="space-y-4"></div>
        </section>
        <section id="tasks" class="section space-y-4">
          <div class="flex items-center justify-between"><h2 class="text-base font-semibold flex items-center gap-2"><i data-lucide="clipboard-list" class="w-5 h-5 text-orange-500"></i><span>Actividades</span></h2></div>
          <div class="flex gap-2 overflow-x-auto pb-1"><button class="task-filter-btn active px-3 py-1 rounded-full text-xs font-medium bg-slate-800 text-white" data-filter="all">Todas</button><button class="task-filter-btn px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-600" data-filter="overdue">Vencidas</button></div>
          <div id="tasksList" class="space-y-4"></div>
        </section>
        <section id="notifications" class="section space-y-6">
          <div class="p-4 rounded-3xl bg-white border shadow-sm"><h2 class="text-base font-semibold flex items-center gap-2"><i data-lucide="bell" class="w-5 h-5 text-blue-600"></i><span>Notificaciones</span></h2></div>
          <div id="systemNotificationsList" class="space-y-3"></div>
        </section>
        <section id="payments" class="section space-y-6">
          <div class="p-4 rounded-3xl bg-white border shadow-sm"><h2 class="text-base font-semibold flex items-center gap-2"><i data-lucide="credit-card" class="w-5 h-5 text-teal-600"></i><span>Mensualidad</span></h2></div>
          <div class="bg-white rounded-3xl border shadow-sm p-4">
            <form id="parentPaymentForm" class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="text-xs text-slate-500">Mes</label>
                  <select id="ppMonth" class="w-full px-3 py-2 rounded-xl border">
                    <option>Enero</option><option>Febrero</option><option>Marzo</option><option>Abril</option>
                    <option>Mayo</option><option>Junio</option><option>Julio</option><option>Agosto</option>
                    <option>Septiembre</option><option>Octubre</option><option>Noviembre</option><option>Diciembre</option>
                  </select>
                </div>
                <div>
                  <label class="text-xs text-slate-500">Monto</label>
                  <input id="ppAmount" type="number" class="w-full px-3 py-2 rounded-xl border" placeholder="0" />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Banco</label>
                  <input id="ppBank" class="w-full px-3 py-2 rounded-xl border" placeholder="Banco" />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Referencia</label>
                  <input id="ppRef" class="w-full px-3 py-2 rounded-xl border" placeholder="0000000000" />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Fecha de transferencia</label>
                  <input id="ppDate" type="date" class="w-full px-3 py-2 rounded-xl border" />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Comprobante</label>
                  <input id="ppEvidence" type="file" accept="image/*" class="w-full px-3 py-2 rounded-xl border" />
                </div>
              </div>
              <div class="flex justify-end gap-2">
                <button type="submit" class="px-4 py-2 rounded-xl bg-teal-600 text-white">Enviar</button>
              </div>
            </form>
            <div class="mt-6">
              <h3 class="text-sm font-semibold mb-2">Historial</h3>
              <table class="w-full text-sm text-left">
                <thead class="bg-slate-50">
                  <tr><th class="px-3 py-2">Mes</th><th class="px-3 py-2">Monto</th><th class="px-3 py-2">Estado</th><th class="px-3 py-2">Evidencia</th></tr>
                </thead>
                <tbody id="parentPaymentsTable" class="divide-y"></tbody>
              </table>
            </div>
          </div>
        </section>
        <section id="profile" class="section space-y-6">
          <div class="p-4 rounded-3xl bg-white border shadow-sm"><h2 class="text-base font-semibold flex items-center gap-2"><i data-lucide="user" class="w-5 h-5 text-slate-600"></i><span>Perfil</span></h2></div>
          <div class="bg-white rounded-3xl border shadow-sm p-4 space-y-6">
            <div class="flex items-center gap-4">
              <img id="profilePhotoPreview" src="img/mundo.jpg" class="w-20 h-20 rounded-full object-cover border" />
              <div class="flex-1 grid grid-cols-2 gap-3">
                <div class="col-span-2">
                  <label class="text-xs text-slate-500">Subir foto</label>
                  <input id="profilePhotoUpload" type="file" class="w-full border rounded-xl p-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Nombre del Estudiante</label>
                  <input id="inputStudentName" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="Nombre" />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Año de Nacimiento</label>
                  <input id="inputBirthYear" type="number" class="w-full px-3 py-2 rounded-xl border" placeholder="2000" />
                </div>
                <div class="col-span-2">
                  <span class="inline-block text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full">Estudiante activo</span>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-slate-50 rounded-2xl p-4 border">
                <p class="text-sm font-semibold">Padre/Madre Principal</p>
                <div class="grid grid-cols-2 gap-3 mt-3">
                  <div class="col-span-2">
                    <label class="text-xs text-slate-500">Nombre Completo</label>
                    <input id="inputParent1Name" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div>
                    <label class="text-xs text-slate-500">Teléfono</label>
                    <input id="inputParent1Phone" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div>
                    <label class="text-xs text-slate-500">Correo Electrónico</label>
                    <input id="inputParent1Email" type="email" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div>
                    <label class="text-xs text-slate-500">Ocupación</label>
                    <input id="inputParent1Occupation" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div>
                    <label class="text-xs text-slate-500">Dirección</label>
                    <input id="inputParent1Address" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div class="col-span-2">
                    <label class="text-xs text-slate-500">Contacto de Emergencia</label>
                    <input id="inputParent1Emergency" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                </div>
              </div>
              <div class="bg-slate-50 rounded-2xl p-4 border">
                <p class="text-sm font-semibold">Padre/Madre Secundario</p>
                <div class="grid grid-cols-2 gap-3 mt-3">
                  <div class="col-span-2">
                    <label class="text-xs text-slate-500">Nombre Completo</label>
                    <input id="inputParent2Name" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div>
                    <label class="text-xs text-slate-500">Teléfono</label>
                    <input id="inputParent2Phone" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div>
                    <label class="text-xs text-slate-500">Correo Electrónico</label>
                    <input id="inputParent2Email" type="email" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div>
                    <label class="text-xs text-slate-500">Ocupación</label>
                    <input id="inputParent2Occupation" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div>
                    <label class="text-xs text-slate-500">Dirección</label>
                    <input id="inputParent2Address" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                  <div class="col-span-2">
                    <label class="text-xs text-slate-500">Contacto de Emergencia</label>
                    <input id="inputParent2Emergency" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-slate-50 rounded-2xl p-4 border">
              <p class="text-sm font-semibold">Información Adicional</p>
              <div class="grid grid-cols-2 gap-3 mt-3">
                <div>
                  <label class="text-xs text-slate-500">Aula Asignada</label>
                  <input id="inputClassroom" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Fecha de Ingreso</label>
                  <input id="inputEntryDate" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="15 de Febrero, 2024" />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Alergias/Condiciones</label>
                  <input id="inputAllergies" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="-" />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Autorizado para Recoger</label>
                  <input id="inputPickup" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="..." />
                </div>
                <div>
                  <label class="text-xs text-slate-500">Tipo de Sangre</label>
                  <input id="inputBloodType" type="text" class="w-full px-3 py-2 rounded-xl border" placeholder="O positivo" />
                </div>
              </div>
            </div>

            <div class="flex justify-end">
              <button id="saveProfileBtn" class="px-4 py-2 rounded-xl bg-slate-800 text-white">Guardar Perfil</button>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <div id="modalSubmitTask" class="hidden fixed inset-0 bg-black/30 flex items-end">
    <div class="bg-white w-full rounded-t-3xl p-4 space-y-3">
      <div class="flex justify-between items-center"><h3 class="text-sm font-semibold">Subir evidencia</h3><button id="closeSubmitTask" class="text-slate-500">Cerrar</button></div>
      <div id="submitTaskForm" class="space-y-3">
        <input id="taskComment" type="text" placeholder="Comentario (opcional)" class="w-full px-3 py-2 rounded-xl border" />
        <label class="block text-xs text-slate-600">Adjuntar archivo</label>
        <input id="taskFile" type="file" class="w-full border rounded-xl p-2 text-sm" />
        <div class="flex gap-2"><p id="taskTitleModal" class="text-sm font-semibold"></p></div>
        <div class="text-xs text-slate-600"><p>Enviado por: <span id="modal-submit-student">...</span></p><p>Supervisado por: <span id="modal-submit-parent">...</span></p></div>
        <button id="submitTaskParent" class="w-full px-3 py-2 rounded-xl bg-orange-500 text-white">Enviar Evidencia</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/supabase.js"></script>
  <script src="js/common_ui.js"></script>
  <script src="js/panel_padres.js?v=4"></script>
  <script>if(window.lucide&&typeof lucide.createIcons==='function'){lucide.createIcons();}</script>
</body>
</html>
